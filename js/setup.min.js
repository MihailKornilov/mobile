$(document).on("click","#setup_info #devs div",function(){function b(b,c){$("#devs span").remove();a.prepend("<span><em"+(c?' class="err"':"")+">"+b+"</em></span>").find("span").delay(1500).fadeOut(1500,function(){$(this).remove()})}for(var a=$(this),c=a.parent().find("input"),e=[],d=0;d<c.length;d++){var f=c.eq(d);1==f.val()&&e.push(f.attr("id"))}e.length?(c={op:"info_devs_set",devs:e.join()},$.post(AJAX_MAIN,c,function(a){a.success&&b("Изменения сохранены")},"json")):b("Не сохранено!<br />Необходимо выбрать<br />минимум одну категорию",
!0)}).on("click","#setup-service-cartridge .add",cartridgeNew).on("click","#setup-service-cartridge .img_edit",function(){function b(){var a=_num($("#join").val()),b={op:"cartridge_edit",id:c,type_id:$("#type_id").val(),name:$("#name").val(),cost_filling:_num($("#cost_filling").val()),cost_restore:_num($("#cost_restore").val()),cost_chip:_num($("#cost_chip").val()),join_id:a?_num($("#join_id").val()):0};b.name?a&&!b.join_id?g.err("Не выбран картридж для объединения"):(g.process(),$.post(AJAX_MAIN,
b,function(a){a.success?($("#spisok").html(a.html),CARTRIDGE_SPISOK=a.cart,g.close(),_msg("Изменено!")):g.abort()},"json")):(g.err("Не указано наименование"),$("#name").focus())}for(var a=$(this),c=a.attr("val");"TR"!=a[0].tagName;)a=a.parent();var e=a.find(".name").html(),d=a.find(".type_id").val(),f=a.find(".filling").val(),h=a.find(".restore").val(),a=a.find(".chip").val(),g=_dialog({top:40,width:400,head:"Редактирование данных картриджа",content:'<table class="setup-tab"><tr><td class="label">Вид:<td><input type="hidden" id="type_id" value="'+
d+'" /><tr><td class="label"><b>Модель картриджа:</b><td><input type="text" id="name" value="'+e+'" /><tr><td class="label">Заправка:<td><input type="text" id="cost_filling" class="money" maxlength="11" value="'+f+'" /> руб.<tr><td class="label">Восстановление:<td><input type="text" id="cost_restore" class="money" maxlength="11" value="'+h+'" /> руб.<tr><td class="label">Замена чипа:<td><input type="text" id="cost_chip" class="money" maxlength="11" value="'+a+'" /> руб.<tr><td><td><tr><td class="label">Объединить:<td><input type="hidden" id="join" /><tr class="tr-join dn"><td class="label">С картриджем:<td><input type="hidden" id="join_id" /></table>',
butSubmit:"Сохранить",submit:b});$("#type_id")._select({spisok:CARTRIDGE_TYPE});$("#name").focus();$("#name,#cost_filling,#cost_restore,#cost_chip").keyEnter(b);$("#join")._check({func:function(a){$(".tr-join")[(a?"remove":"add")+"Class"]("dn")}});e=[];for(d=0;d<CARTRIDGE_SPISOK.length;d++)f=CARTRIDGE_SPISOK[d],f.uid!=c&&e.push(f);$("#join_id")._select({width:218,write:1,title0:"Не выбрано",spisok:e})}).on("mouseleave","#setup-service-cartridge .edited",function(){$(this).css("background-color","#fff")}).ready(function(){$("#setup_info").length&&
($("#type")._select({width:200,spisok:WS_TYPE}),$("#info_save").click(function(){var b=$(this),a={op:"info_save",type:$("#type").val()};b.addClass("_busy");$.post(AJAX_MAIN,a,function(a){a.success?(_msg("Данные изменены"),document.location.reload()):b.removeClass("_busy")},"json")}),$("#info_del").click(function(){var b=_dialog({top:150,width:300,head:"Удаление организации",content:"<center>Вы действительно хотите<BR>удалить организацию и все данные?</center>",butSubmit:"&nbsp;&nbsp;&nbsp;&nbsp;Да&nbsp;&nbsp;&nbsp;&nbsp;",
submit:function(){b.process();$.post(AJAX_MAIN,{op:"info_del"},function(a){a.success?location.href=URL:b.abort()},"json")}})}))});
