$(document).on("blur","#setup_main #org_name",function(){var a=$(this),b={op:"setup_org_name_save",name:a.val()};a.hasClass("busy")||G.org_name==b.name||(a.addClass("busy").next("span").remove(),a.after('<img src="/img/upload.gif">'),$.post(AJAX_WS,b,function(c){a.removeClass("busy").next("img").remove();c.success&&(G.org_name=b.name,a.after('<span class="saved">Сохранено.</span>').next("span").delay(1500).fadeOut(1500,function(){$(this).remove()}))},"json"))}).on("click","#setup_main #devs div",
function(){function a(a,f){$("#setup_main #devs span").remove();b.prepend("<span><em"+(f?' class="err"':"")+">"+a+"</em></span>").find("span").delay(1500).fadeOut(1500,function(){$(this).remove()})}for(var b=$(this),c=b.parent().find("input"),e=[],d=0;d<c.length;d++){var f=c.eq(d);1==f.val()&&e.push(f.attr("id"))}0==e.length?a("Не сохранено!<br />Необходимо выбрать<br />минимум одну категорию",!0):(c={op:"setup_devs_set",devs:e.join()},$.post(AJAX_WS,c,function(b){b.success&&a("Изменения сохранены")},
"json"))}).on("click","#setup_main #ws_del",function(){var a=_dialog({top:150,width:300,head:"Удаление мастерской",content:"<center>Вы действительно хотите<BR>удалить мастерскую и все данные?</center>",butSubmit:"&nbsp;&nbsp;&nbsp;&nbsp;Да&nbsp;&nbsp;&nbsp;&nbsp;",submit:function(){a.process();$.post(AJAX_WS,{op:"setup_ws_del"},function(b){b.success?location.href=URL:a.abort()},"json")}})}).on("click","#setup_worker .add",function(){function a(){if(!d.hasClass("busy")){e=0;$(".res").remove();var a=
{user_ids:$.trim($("#viewer_id").val()),fields:"photo_50",v:5.2};a.user_ids&&(/vk.com/.test(a.user_ids)&&(a.user_ids=a.user_ids.split("vk.com/")[1]),/\?/.test(a.user_ids)&&(a.user_ids=a.user_ids.split("?")[0]),/#/.test(a.user_ids)&&(a.user_ids=a.user_ids.split("#")[0]),d.addClass("busy"),VK.api("users.get",a,function(a){d.removeClass("busy");a.response&&(a=a.response[0],d.after('<table class="res"><tr><td class="photo"><img src='+a.photo_50+'><td class="name">'+a.first_name+" "+a.last_name+"</table>"),
e=a.id)}))}}function b(a,b){c.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",remove:1,indent:40,show:1,top:b,left:90})}var c=_dialog({top:50,width:350,head:"Добавление нового сотрудника",content:'<div id="setup_worker_add"><h1>Укажите адрес страницы пользователя или его<br />ID ВКонтакте:</h1><h2>Формат адреса может быть следующих видов:<br /><u>http://vk.com/id12345</u>, <u>http://vk.com/durov</u>.<br />Либо используйте ID пользователя: <u>id12345</u>, <u>durov</u>, <u>12345</u>.</h2><input type="text" id="viewer_id" /><div class="vkButton"><button>Найти</button></div><a class="manual">Или заполните данные вручную..</a><table class="manual_tab"><tr><td class="label">Имя:<td><input type="text" id="first_name" /><tr><td class="label">Фамилия:<td><input type="text" id="last_name" /><tr><td class="label">Пол:<td><input type="hidden" id="sex" /></table></div>',
butSubmit:"Добавить",submit:function(){var a={op:"setup_worker_add",viewer_id:e,first_name:$("#first_name").val(),last_name:$("#last_name").val(),sex:$("#sex").val()};a.viewer_id||a.first_name||a.last_name?a.first_name&&a.last_name&&0==a.sex?b("Не указан пол",-47):(c.process(),$.post(AJAX_WS,a,function(a){a.success?(c.close(),_msg("Новый сотрудник успешно добавлен."),$("#spisok").html(a.html)):(c.abort(),b(a.text,-60))},"json")):b("Произведите поиск пользователя<br>или укажите вручную имя и фамилию",
-60)}}),e=0,d=$("#viewer_id").focus().keyEnter(a).next();d.click(a);$(".manual").click(function(){$(this).hide().next().show();$(".res").remove();e=0;$("#viewer_id").val("");$("#first_name").focus()});$("#sex")._radio({spisok:[{uid:2,title:"М"},{uid:1,title:"Ж"}]})}).on("click","#setup_worker .img_del",function(){for(var a=$(this);!a.hasClass("unit");)a=a.parent();var b=_dialog({top:110,width:250,head:"Удаление сотрудника",content:"<center>Подтвердите удаление сотрудника.</center>",butSubmit:"Удалить",
submit:function(){var c={op:"setup_worker_del",viewer_id:a.attr("val")};b.process();$.post(AJAX_WS,c,function(a){a.success?(b.close(),_msg("Сотрудник удален."),$("#spisok").html(a.html)):b.abort()},"json")}})}).on("click","#setup_workers .add",function(){function a(){if(!d.hasClass("busy")){c=!1;var a={user_ids:$.trim(e.val()),fields:"photo_50",v:5.2};a.user_ids&&(d.addClass("busy").next(".res").remove(),VK.api("users.get",a,function(a){d.removeClass("busy");a.response&&(a=a.response[0],d.after('<TABLE class="res"><TR><TD class="photo"><IMG src='+
a.photo_50+'><TD class="name">'+a.first_name+" "+a.last_name+"</TABLE>"),c=a.id)}))}}var b=_dialog({top:50,width:360,head:"Добавление нового сотрудника",content:'<div id="setup_worker_add"><h1>Ссылка на страницу или ID пользователя ВКонтакте:</h1><input type="text" /><DIV class="vkButton"><BUTTON>Найти</BUTTON></DIV></div>',butSubmit:"Добавить",submit:function(){if(c){var a={op:"setup_worker_add",id:c};b.process();$.post(AJAX_WS,a,function(a){b.abort();a.success?(b.close(),_msg("Новый сотрудник успешно добавлен."),
$("#spisok").html(a.html)):b.bottom.vkHint({msg:'<SPAN class="red">'+a.text+"</SPAN>",remove:1,indent:40,show:1,top:-60,left:92})},"json")}else b.bottom.vkHint({msg:'<SPAN class="red">Не выбран пользователь</SPAN>',remove:1,indent:40,show:1,top:-48,left:92})}}),c,e=b.content.find("input"),d=e.next();e.focus().keyEnter(a);d.click(a)}).on("click","#setup_workers .img_del",function(){for(var a=$(this);!a.hasClass("unit");)a=a.parent();var b=_dialog({top:110,width:250,head:"Удаление сотрудника",content:"<center>Подтвердите удаление сотрудника.</center>",
butSubmit:"Удалить",submit:function(){var c={op:"setup_worker_del",viewer_id:a.attr("val")};b.process();$.post(AJAX_WS,c,function(a){a.success?(b.close(),_msg("Сотрудник удален."),$("#spisok").html(a.html)):b.abort()},"json")}})}).on("click","#setup_workers .adm_set",function(){for(var a=$(this),b=$(this).parent();!a.hasClass("unit");)a=a.parent();a={op:"setup_worker_admin_set",viewer_id:a.attr("val")};b.hasClass("busy")||(b.html("&nbsp;").addClass("busy"),$.post(AJAX_WS,a,function(a){b.removeClass("busy");
a.success&&b.html('Администратор <a class="adm_cancel">отменить</a>')},"json"))}).on("click","#setup_workers .adm_cancel",function(){for(var a=$(this),b=$(this).parent();!a.hasClass("unit");)a=a.parent();a={op:"setup_worker_admin_cancel",viewer_id:a.attr("val")};b.hasClass("busy")||(b.html("&nbsp;").addClass("busy"),$.post(AJAX_WS,a,function(a){b.removeClass("busy");a.success&&b.html('<a class="adm_set">Назначить администратором</a>')},"json"))}).ready(function(){});
