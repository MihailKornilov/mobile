var AJAX_WS=SITE+"/ajax/ws.php?"+VALUES,scannerWord="",scannerTime=0,scannerTimer,scannerDialog,scannerDialogShow=!1,charSpisok={48:"0",49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9,65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",189:"-"},modelImageGet=function(){var a={op:"model_img_get",model_id:$("#dev_model").val()},b=$("#device_image");b.html("");0<a.model_id&&
(b.addClass("busy"),$.post(AJAX_WS,a,function(a){if(a.success)b.html(a.img).find("img").on("load",function(){$(this).show().parent().removeClass("busy")})},"json"))},colorSel=function(a){$("#color_id")._select({width:120,title0:"Цвет не указан",spisok:a,func:colorSelDop});$("#color_dop")._select({width:120,title0:"Цвет не указан",spisok:COLOR_SPISOK,func:function(a){colorSel(a?COLORPRE_SPISOK:COLOR_SPISOK)}})},colorSelDop=function(a){a?(0==$("#color_id_select").length&&colorSel(0<$("#color_dop").val()?
COLORPRE_SPISOK:COLOR_SPISOK),$(".color_dop").removeClass("dn")):(colorSel(COLOR_SPISOK),$("#color_dop")._select(0),$(".color_dop").addClass("dn"))},clientAdd=function(a){var b=_dialog({width:340,head:"Добавление нoвого клиента",content:'<table style="border-spacing:10px"><tr><td class="label">Имя:<TD><input type="text" id="fio" style="width:220px;"><tr><td class="label">Телефон:<TD><input type="text" id="telefon" style=width:220px;></TABLE>',submit:function(){var c={op:"client_add",fio:$("#fio").val(),
telefon:$("#telefon").val()};c.fio?(b.process(),$.post(AJAX_WS,c,function(c){c.success?(b.close(),_msg("Новый клиент внесён."),"function"==typeof a?a(c):document.location.href=URL+"&p=client&d=info&id="+c.uid):b.abort()},"json")):(b.bottom.vkHint({msg:'<SPAN class="red">Не указано имя клиента.</SPAN>',top:-47,left:81,indent:40,show:1,remove:1,correct:0}),$("#fio").focus())}});$("#fio").focus()},clientFilter=function(){var a={fast:cFind.inp(),dolg:$("#dolg").val(),active:$("#active").val(),comm:$("#comm").val()};
$(".filter")[a.fast?"hide":"show"]();return a},clientSpisok=function(){var a=clientFilter(),b=$(".result");a.op="client_spisok";b.hasClass("busy")||(b.addClass("busy"),$.post(AJAX_WS,a,function(a){b.removeClass("busy");a.success&&(b.html(a.all),$(".left").html(a.spisok))},"json"))},clientZayavFilter=function(){return{client:CLIENT.id,status:$("#status").val(),diff:$("#diff").val(),device:$("#dev_device").val(),vendor:$("#dev_vendor").val(),model:$("#dev_model").val()}},clientZayavSpisok=function(){var a=
clientZayavFilter();a.op="client_zayav_spisok";$("#dopLinks").addClass("busy");$.post(AJAX_WS,a,function(a){$("#dopLinks").removeClass("busy");$("#zayav_result").html(a.all);$("#zayav_spisok").html(a.html)},"json")},zayavFilter=function(){var a={find:$.trim($("#find input").val()),sort:$("#sort").val(),desc:$("#desc").val(),status:$("#status").val(),diff:$("#diff").val(),zpzakaz:$("#zpzakaz").val(),device:$("#dev_device").val(),vendor:$("#dev_vendor").val(),model:$("#dev_model").val(),place:$("#device_place").val(),
devstatus:$("#devstatus").val()},b="";"1"!=a.sort&&(b+=".sort="+a.sort);"0"!=a.desc&&(b+=".desc="+a.desc);a.find?b+=".find="+escape(a.find):(0<a.status&&(b+=".status="+a.status),0<a.diff&&(b+=".diff="+a.diff),0<a.zpzakaz&&(b+=".zpzakaz="+a.zpzakaz),0<a.device&&(b+=".device="+a.device),0<a.vendor&&(b+=".vendor="+a.vendor),0<a.model&&(b+=".model="+a.model),0!=a.place&&(b+=".place="+a.place),0<a.devstatus&&(b+=".devstatus="+a.devstatus));VK.callMethod("setLocation",hashLoc+b);setCookie("zayav_find",
escape(a.find));setCookie("zayav_sort",a.sort);setCookie("zayav_desc",a.desc);setCookie("zayav_status",a.status);setCookie("zayav_diff",a.diff);setCookie("zayav_zpzakaz",a.zpzakaz);setCookie("zayav_device",a.device);setCookie("zayav_vendor",a.vendor);setCookie("zayav_model",a.model);setCookie("zayav_place",encodeURI(a.place));setCookie("zayav_devstatus",a.devstatus);return a},zayavSpisokLoad=function(){var a=zayavFilter();$(".condLost")[(a.find?"add":"remove")+"Class"]("hide");a.op="zayav_spisok_load";
$("#mainLinks").addClass("busy");$.post(AJAX_WS,a,function(a){$("#zayav .result").html(a.all);$("#zayav #spisok").html(a.html);$("#mainLinks").removeClass("busy")},"json")},zayavImgUpdate=function(){$.post(AJAX_WS,{op:"zayav_img_update",zayav_id:ZAYAV.id},function(a){a.success&&$("#foto").html(a.html)},"json")},zayavInfoMoneyUpdate=function(a){$("b.acc").html(a.acc);$(".acc_tr")[(0==a.acc?"add":"remove")+"Class"]("dn");$("b.op").html(a.opl);$(".op_tr")[(0==a.opl?"add":"remove")+"Class"]("dn");$(".dopl")[(0==
a.diff?"add":"remove")+"Class"]("dn").html((0<a.diff?"+":"")+a.diff);a=0==a.acc&&0==a.opl;$(".delete")[(a?"remove":"add")+"Class"]("dn")},zayavDevSelect=function(a){modelImageGet(a);0==a.device_id?($(".equip_spisok").html(""),$(".tr_equip").addClass("dn")):0==a.vendor_id&&0==a.model_id&&$.post(AJAX_WS,{op:"equip_check_get",device_id:a.device_id},function(a){a.spisok?($(".equip_spisok").html(a.spisok),$(".tr_equip").removeClass("dn")):($(".equip_spisok").html(""),$(".tr_equip").addClass("dn"))},"json")},
zpFilter=function(){var a={find:$.trim($("#find input").val()),menu:$("#menu").val(),name:$("#zp_name").val(),device:$("#dev_device").val(),vendor:$("#dev_vendor").val(),model:$("#dev_model").val(),bu:$("#bu").val()},b="";a.find&&(b+=".find="+escape(a.find));0<a.menu&&(b+=".menu="+a.menu);0<a.name&&(b+=".name="+a.name);0<a.device&&(b+=".device="+a.device);0<a.vendor&&(b+=".vendor="+a.vendor);0<a.model&&(b+=".model="+a.model);0<a.bu&&(b+=".bu="+a.bu);VK.callMethod("setLocation",hashLoc+b);return a},
zpSpisokLoad=function(){var a=zpFilter();a.op="zp_spisok_load";$("#mainLinks").addClass("busy");$.post(AJAX_WS,a,function(a){$("#mainLinks").removeClass("busy");$("#zp .result").html(a.all);$("#zp .left").html(a.html)},"json")},zpImgUpdate=function(){$.post(AJAX_WS,{op:"zp_img_update",zp_id:ZP.compat_id},function(a){a.success&&$("#foto").html(a.html)},"json")},zpAvaiAdd=function(a){var b=_dialog({head:"Внесение наличия запчасти",content:'<table class="avaiAddTab"><tr><td class="left"><div class="name">'+
a.name+"</div><div>"+a["for"]+'</div><div class="avai">Текущее наличие: <b>'+a.count+'</b> шт.</div><table class="inp"><tr><td class="label">Количество:<td><input type="text" id="count" maxlength="5"><tr><td class="label">Цена за ед.:<td><input type="text" id="cena" maxlength="10"><span>не обязательно</span></table><td valign="top">'+a.img+"</table>",submit:function(){var c,d={op:"zp_avai_add",zp_id:a.zp_id,count:$("#count").val(),cena:$("#cena").val()};d.cena||(d.cena=0);REGEXP_NUMERIC.test(d.count)&&
0!=d.count?0==d.cena||REGEXP_CENA.test(d.cena)?(b.process(),$.post(AJAX_WS,d,function(c){b.abort();c.success&&(a.callback(c),b.close(),_msg("Внесение наличия запчасти произведено."))},"json")):(c="Некорректно указана цена.",$("#cena").focus()):(c="Некорректно указано количество.",$("#count").focus());c&&b.bottom.vkHint({msg:'<SPAN class="red">'+c+"</SPAN>",remove:1,indent:40,show:1,top:-48,left:92})}});$("#count").focus()},zpAvaiNo=function(a){return 0==a?(_dialog({top:100,width:300,head:"Нет наличия",
content:"<center>Запчасти нет в наличии.</center>",butSubmit:"",butCancel:"Закрыть"}),!0):!1},zpAvaiUpdate=function(){$.post(AJAX_WS,{op:"zp_avai_update",zp_id:ZP.id},function(a){a.success&&(ZP.count=a.count,$(".move").html(a.move),$(".avai")[(0==a.count?"add":"remove")+"Class"]("no").html(0==a.count?"Нет в наличии.":"В наличии "+a.count+" шт."))},"json")},historySpisok=function(){var a={op:"history_spisok",worker:$("#worker").val(),action:$("#action").val()};$("#mainLinks").addClass("busy");$.post(AJAX_WS,
a,function(a){$(".left").html(a.html);$("#mainLinks").removeClass("busy")},"json")},remindSpisok=function(){var a={op:"remind_spisok",status:$("#status").val(),"private":$("#private").val()};$("#mainLinks").addClass("busy");$.post(AJAX_WS,a,function(a){$(".left").html(a.html);$("#mainLinks").removeClass("busy")},"json")},incomeSpisok=function(){var a={op:"income_spisok",day:$(".selected").val(),del:$("#del").val()};$.post(AJAX_WS,a,function(a){a.success&&($(".inc-path").html(a.path),$(".spisok").html(a.html))},
"json")},expenseSpisok=function(){var a={op:"expense_spisok",category:$("#category").val(),worker:$("#worker").val(),year:$("#year").val(),month:$("#monthSum").val()};$("#mainLinks").addClass("busy");$.post(AJAX_WS,a,function(a){$("#mainLinks").removeClass("busy");a.success&&($("#spisok").html(a.html),$("#monthList").html(a.mon))},"json")},reportKassaLoad=function(){var a={op:"report_kassa_load",del_show:1==$("#kassaShowDel").val()?1:0};$("#mainLinks").addClass("busy");$.post(AJAX_WS,a,function(a){$("#report_kassa #spisok").html(a.html);
$("#mainLinks").removeClass("busy")},"json")};
$.fn.clientSel=function(a){function b(b){b={op:"client_sel",val:b||"",client_id:a.client_id};c._select("process");$.post(AJAX_WS,b,function(b){c._select("cancel");b.success&&(c._select(b.spisok),a.client_id&&(c._select(a.client_id),a.client_id=0))},"json")}var c=$(this);a=$.extend({width:260,add:null,client_id:c.val()||0,func:function(){}},a);a.add&&(a.add=function(){clientAdd(function(a){var b=[];b.push(a);c._select(b);c._select(a.uid)})});c._select({width:a.width,title0:"Начните вводить данные клиента...",
spisok:[],write:1,nofind:"Клиентов не найдено",func:a.func,funcAdd:a.add,funcKeyup:b});b();return c};
$.fn.device=function(a){function b(){var b={op:"base_device_add",name:$("#daname").focus().val()};b.name?q(DEV_SPISOK,b.name)?e():(l.process(),$.post(AJAX_WS,b,function(c){l.abort();c.success&&(DEV_SPISOK.push({uid:c.id,title:b.name}),DEV_ASS[c.id]=name,t._select(DEV_SPISOK)._select(c.id),f(0),r.val(0)._select("remove"),a.func(p()),l.close())},"json")):e("Не указано название устройства.")}function c(){var a=t.val(),b={op:"base_vendor_add",device_id:a,name:$("#vaname").focus().val()};b.name?q(VENDOR_SPISOK[a],
b.name)?e():(l.process(),$.post(AJAX_WS,b,function(c){l.abort();c.success&&(VENDOR_SPISOK[a]||(VENDOR_SPISOK[a]=[]),VENDOR_SPISOK[a].push({uid:c.id,title:b.name}),VENDOR_ASS[c.id]=b.name,s._select(VENDOR_SPISOK[a])._select(c.id),g(),l.close())},"json")):e("Не указано название производителя.")}function d(){var a=s.val(),b={op:"base_model_add",device_id:t.val(),vendor_id:a,name:$("#maname").focus().val()};b.name?q(MODEL_SPISOK[a],b.name)?e():(l.process(),$.post(AJAX_WS,b,function(c){l.abort();c.success&&
(MODEL_SPISOK[a]||(MODEL_SPISOK[a]=[]),MODEL_SPISOK[a].push({uid:c.id,title:b.name}),MODEL_ASS[c.id]=b.name,r._select(MODEL_SPISOK[a])._select(c.id),l.close())},"json")):e("Не указано название модели.")}function e(a){l.bottom.vkHint({msg:'<SPAN class="red">'+(a||"Такое название уже есть в списке.")+"</SPAN>",top:-47,left:53,indent:50,show:1,remove:1})}function f(b){void 0!=b&&(a.vendor_id=b);s.val(a.vendor_id);s._select({width:a.width,block:1,title0:u[a.type_no],spisok:VENDOR_SPISOK[t.val()],func:function(b){r.val(0);
b?g(0):r._select("remove");a.func(p())},funcAdd:a.vendor_funcAdd,bottom:3});s._select(a.vendor_id);a.vendor_id&&g()}function g(b){void 0!=b&&(a.model_id=b);r.val(a.model_id);r._select({width:a.width,block:1,write:1,title0:v[a.type_no],spisok:MODEL_SPISOK[s.val()],limit:50,funcAdd:a.model_funcAdd,bottom:10,func:function(){a.func(p())}});r._select(a.model_id)}function q(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].title.toLowerCase()==b)return!0;return!1}function p(){return{device_id:t.val(),
vendor_id:s.val(),model_id:r.val()}}a=$.extend({width:150,func:function(){},type_no:0,device_id:0,vendor_id:0,model_id:0,device_ids:null,vendor_ids:null,model_ids:null,add:0,device_funcAdd:null,vendor_funcAdd:null,model_funcAdd:null},a);var m=$(this),h=m.attr("id"),u=["Производитель не выбран","Любой производитель"],v=["Модель не выбрана","Любая модель"],l;m.html('<input type="hidden" id="'+h+'_device" value="'+a.device_id+'"><input type="hidden" id="'+h+'_vendor" value="'+a.vendor_id+'"><input type="hidden" id="'+
h+'_model" value="'+a.model_id+'">');var t=$("#"+h+"_device"),s=$("#"+h+"_vendor"),r=$("#"+h+"_model");if(a.device_ids)for(DEV_SPISOK=[],n=0;n<a.device_ids.length;n++)m=a.device_ids[n],DEV_SPISOK.push({uid:m,title:DEV_ASS[m]});if(a.vendor_ids){h={};for(k in VENDOR_SPISOK)for(n=0;n<VENDOR_SPISOK[k].length;n++)m=VENDOR_SPISOK[k][n],0<=a.vendor_ids.indexOf(m.uid)&&(void 0==h[k]&&(h[k]=[]),h[k].push(m));VENDOR_SPISOK=h}if(a.model_ids){h={};for(k in MODEL_SPISOK)for(n=0;n<MODEL_SPISOK[k].length;n++)m=
MODEL_SPISOK[k][n],0<=a.model_ids.indexOf(m.uid)&&(h[k]||(h[k]=[]),h[k].push(m));MODEL_SPISOK=h}0<a.add&&(a.device_funcAdd=function(){l=_dialog({width:300,head:"Добавление нoвого устройства",content:'<table class="device-add-tab"><tr><td class="label">Название:<TD><input type="text" id="daname"></table>',submit:b});$("#daname").focus().keyEnter(b)},a.vendor_funcAdd=function(){l=_dialog({width:300,head:"Добавление нoвого производителя",content:'<TABLE class="device-add-tab"><TR><TD class="label">Название:<TD><input type="text" id="vaname"></TABLE>',
submit:c});$("#vaname").focus().keyEnter(c)},a.model_funcAdd=function(){l=_dialog({width:300,head:"Добавление нoвой модели",content:'<TABLE class="device-add-tab"><TR><TD class="label">Название:<TD><input type="text" id="maname"></TABLE>',submit:d,focus:"#model_name"});$("#maname").focus().keyEnter(d)});t._select({width:a.width,block:1,title0:["Устройство не выбрано","Любое устройство"][a.type_no],spisok:DEV_SPISOK,func:function(b){s.val(0);r.val(0)._select("remove");b?f(0):s._select("remove");a.func(p())},
funcAdd:a.device_funcAdd,bottom:3});a.device_id&&f()};
$(document).keydown(function(a){function b(){scannerWord="";scannerTime=0;scannerTimer&&clearTimeout(scannerTimer);scannerTimer=void 0;scannerDialogShow=!1}if(!scannerDialogShow)if(13==a.keyCode){if(a=(new Date).getTime()-scannerTime,5<scannerWord.length&&300>a){scannerDialogShow=!0;scannerTimer=setTimeout(b,500);scannerDialog=_dialog({head:"Сканер штрих-кода",top:60,width:250,content:"Получен код: <b>"+scannerWord+"</b>",butSubmit:"Поиск"});var c={op:"scanner_word",word:scannerWord};scannerDialog.process();
$.post(AJAX_WS,c,function(a){a.success?document.location.href=a.zayav_id?URL+"&p=zayav&d=info&id="+a.zayav_id:URL+"&p=zayav&d=add&"+(a.imei?"imei":"serial")+"="+c.word:scannerDialog.abort()},"json")}}else scannerDialog&&(scannerDialog.close(),scannerDialog=void 0),scannerTimer&&clearTimeout(scannerTimer),scannerTimer=setTimeout(b,500),scannerWord||(scannerTime=(new Date).getTime()),scannerWord+=charSpisok[a.keyCode]||""}).on("mouseenter",".zayav_link",function(a){a=$(this);var b=a.find(".tooltip");
b.hasClass("empty")&&(a={op:"tooltip_zayav_info_get",id:a.attr("val")},$.post(AJAX_WS,a,function(a){b.html(a.html).removeClass("empty")},"json"))}).on("keyup","#zayavNomer",function(){var a=$(this);if(!a.hasClass("busy")){a.next(".zayavNomerTab").remove().end().after('<img src="/img/upload.gif">').addClass("busy");var b={op:"zayav_nomer_info",nomer:a.val()};$.post(AJAX_WS,b,function(b){a.removeClass("busy").next("img").remove();b.success&&a.after(b.html)},"json")}}).on("click","#client ._next",function(){if(!$(this).hasClass("busy")){var a=
$(this),b=clientFilter();b.op="client_next";b.page=a.attr("val");a.addClass("busy");$.post(AJAX_WS,b,function(b){b.success?(a.remove(),$("#client .left").append(b.spisok)):a.removeClass("busy")},"json")}}).on("click","#clientInfo .cedit",function(){function a(){var a,b={op:"client_edit",client_id:CLIENT.id,fio:$.trim($("#fio").val()),telefon:$.trim($("#telefon").val()),join:$("#join").val(),client2:$("#client2").val()};0==b.join&&(b.client2=0);b.fio?1==b.join&&0==b.client2?a="Укажите второго клиента.":
1==b.join&&b.client2==CLIENT.id?a="Выберите другого клиента.":(c.process(),$.post(AJAX_WS,b,function(a){c.abort();a.success&&($(".fio").html(b.fio),$(".telefon").html(b.telefon),CLIENT.fio=b.fio,0<b.client2&&document.location.reload(),c.close(),_msg("Данные клиента изменены."))},"json")):(a="Не указано имя клиента.",$("#fio").focus());a&&c.bottom.vkHint({msg:"<SPAN class=red>"+a+"</SPAN>",top:-47,left:100,indent:50,show:1,remove:1})}var b='<TABLE class="client_edit"><tr><td class="label">Имя:<TD><input type="text" id="fio" value="'+
$(".fio").html()+'"><tr><td class="label">Телефон:<TD><input type="text" id="telefon" value="'+$(".telefon").html()+'"><tr><td class="label">Объединить:<TD><input type="hidden" id="join"><TR class=tr_join><TD class="label">с клиентом:<TD><input type="hidden" id="client2"></TABLE>',c=_dialog({head:"Редактирование данных клиента",top:60,width:400,content:b,butSubmit:"Сохранить",submit:a});$("#fio,#telefon").keyEnter(a);$("#join")._check();$("#join_check").click(function(){$(".tr_join").toggle()}).vkHint({msg:"<B>Объединение клиентов.</B><br />Необходимо, если один клиент был внесён в базу дважды.<br /><br />Текущий клиент будет получателем.<br />Выберите второго клиента.<br />Все заявки, начисления и платежи станут общими после<br />объединения.<br /><br />Внимание, операция необратима!",
width:330,delayShow:1500,top:-162,left:-79,indent:80});$("#client2").clientSel({width:240})}).on("click","#clientInfo #zayav_spisok ._next",function(){if(!$(this).hasClass("busy")){var a=$(this),b=clientZayavFilter();b.op="client_zayav_next";b.page=$(this).attr("val");a.addClass("busy");$.post(AJAX_WS,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json")}}).on("click","#clientInfo .remind_add",function(){var a=_dialog({top:60,width:480,head:"Добавление нового задания",content:'<TABLE class="remind_add_tab"><tr><td class="label">Клиент:<TD><b>'+
CLIENT.fio+'</b><tr><td class="label top">Описание задания:<TD><TEXTAREA id="txt"></TEXTAREA><tr><td class="label">Крайний день выполнения:<TD><INPUT type="hidden" id="data"><tr><td class="label">Личное:<TD><INPUT type="hidden" id="private"></TABLE>',submit:function(){var e={op:"report_remind_add",from_client:1,client_id:CLIENT.id,zayav_id:0,txt:b.val(),day:c.val(),"private":d.val()};e.txt?(a.process(),$.post(AJAX_WS,e,function(b){a.abort();b.success&&(a.close(),_msg("Новое задание успешно добавлено."),
$("#remind_spisok").html(b.html))},"json")):(a.bottom.vkHint({msg:"<SPAN class=red>Не указано содержание напоминания.</SPAN>",remove:1,indent:40,show:1,top:-48,left:150}),b.focus())}}),b=$(".remind_add_tab #txt"),c=$(".remind_add_tab #data"),d=$(".remind_add_tab #private");b.autosize().focus();c._calendar();d._check();$(".remind_add_tab #private_check").vkHint({msg:"Задание сможете<br />видеть только Вы.",top:-71,left:-11,indent:"left",delayShow:1E3})}).on("click","#clientInfo #histories ._next",
function(){if(!$(this).hasClass("busy")){var a=$(this),b={op:"client_history_next",page:$(this).attr("val"),client_id:CLIENT.id};a.addClass("busy");$.post(AJAX_WS,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json")}}).on("click","#zayav ._next",function(){if(!$(this).hasClass("busy")){var a=$(this),b=zayavFilter();b.op="zayav_next";b.page=$(this).attr("val");a.addClass("busy");$.post(AJAX_WS,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json")}}).on("click",
".zayav_unit",function(){document.location.href=URL+"&p=zayav&d=info&id="+$(this).attr("val")}).on("mouseenter",".zayav_unit",function(){var a=$(this),b=a.find(".msg").val();b&&a.vkHint({width:150,msg:b,ugol:"left",top:10,left:a.width()+43,show:1,indent:5,delayShow:500})}).on("click","#zayav #sort_radio div",zayavSpisokLoad).on("click","#zayav #zpzakaz_radio div",zayavSpisokLoad).on("click","#zayav #filter_break",function(){zFind.clear();$("#sort")._radio(1);$("#desc")._check(0);$("#status").rightLink(0);
$("#diff")._check(0);$("#zpzakaz")._radio(0);$("#dev").device({width:155,type_no:1,device_ids:DEVICE_IDS,vendor_ids:VENDOR_IDS,model_ids:MODEL_IDS,func:zayavSpisokLoad});$("#device_place")._select(0);$("#devstatus")._select(0);zayavSpisokLoad()}).on("click","#zayavInfo .zedit",function(){var a=_dialog({width:410,top:30,head:"Заявка №"+ZAYAV.nomer+" - Редактирование",content:'<TABLE class="zayav-info-edit"><tr><td class="label r">Клиент:\t\t<TD><INPUT type="hidden" id="client_id" value="'+ZAYAV.client_id+
'"><tr><td class="label r top">Устройство:<TD><TABLE><TD id="dev"><TD id="device_image"></TABLE><tr><td class="label r">IMEI:\t\t  <TD><INPUT type="text" id="imei" maxlength="20" value="'+ZAYAV.imei+'"><tr><td class="label r">Серийный номер:<TD><INPUT type="text" id="serial" maxlength="30" value="'+ZAYAV.serial+'"><tr><td class="label r">Цвет:<td><INPUT type="hidden" id="color_id" value="'+ZAYAV.color_id+'" /><span class="color_dop dn"><tt>-</tt><INPUT TYPE="hidden" id="color_dop" value="'+ZAYAV.color_dop+
'" /></span><tr class="tr_equip'+(ZAYAV.equip?"":" dn")+'"><td class="label r top">Комплектация:<TD class="equip_spisok">'+ZAYAV.equip+"</TABLE>",butSubmit:"Сохранить",submit:function(){var b,c={op:"zayav_edit",zayav_id:ZAYAV.id,client_id:$("#client_id").val(),device:$("#dev_device").val(),vendor:$("#dev_vendor").val(),model:$("#dev_model").val(),imei:$.trim($("#imei").val()),serial:$.trim($("#serial").val()),color_id:$("#color_id").val(),color_dop:$("#color_dop").val(),equip:""};if(!$(".tr_equip").hasClass("dn")){for(var d=
$(".equip_spisok input"),e=[],f=0;f<d.length;f++){var g=d.eq(f);1==g.val()&&e.push(g.attr("id").split("_")[1])}c.equip=e.join()}0==c.deivce?b="Не выбрано устройство":0==c.client_id?b="Не выбран клиент":(a.process(),$.post(AJAX_WS,c,function(b){a.close();_msg("Данные изменены!");document.location.reload()},"json"));b&&a.bottom.vkHint({msg:'<SPAN class="red">'+b+"</SPAN>",top:-47,left:107,show:1,remove:1,correct:0})}});$("#client_id").clientSel();$("#client_id_select").vkHint({msg:"Если изменяется клиент, то начисления и платежи заявки применяются на нового клиента.",
width:200,top:-83,left:-2,delayShow:1500,correct:0});$("#dev").device({width:190,device_id:ZAYAV.device,vendor_id:ZAYAV.vendor,model_id:ZAYAV.model,add:1,func:zayavDevSelect});modelImageGet();colorSelDop(ZAYAV.color_id)}).on("click","#zayavInfo .delete",function(){var a=_dialog({top:110,width:250,head:"Удаление заявки",content:"<CENTER>Подтвердите удаление заявки.</CENTER>",butSubmit:"Удалить",submit:function(){var b={op:"zayav_delete",zayav_id:ZAYAV.id};a.process();$.post(AJAX_WS,b,function(a){a.success&&
(location.href=URL+"&p=client&d=info&id="+a.client_id)},"json")}})}).on("click","#zayavInfo .remind_add",function(){var a=_dialog({top:60,width:480,head:"Добавление нового задания",content:'<TABLE class="remind_add_tab"><tr><td class="label">Заявка:<TD>№<b>'+ZAYAV.nomer+'</b><tr><td class="label top">Описание задания:<TD><TEXTAREA id="txt"></TEXTAREA><tr><td class="label">Крайний день выполнения:<TD><INPUT type="hidden" id="data"><tr><td class="label">Личное:<TD><INPUT type="hidden" id="private"></TABLE>',
submit:function(){var e={op:"report_remind_add",from_zayav:1,client_id:0,zayav_id:ZAYAV.id,txt:b.val(),day:c.val(),"private":d.val()};e.txt?(a.process(),$.post(AJAX_WS,e,function(b){b.success?(a.close(),_msg("Новое задание успешно добавлено."),$("#remind_spisok").html(b.html)):a.abort()},"json")):(a.bottom.vkHint({msg:"<SPAN class=red>Не указано содержание напоминания.</SPAN>",remove:1,indent:40,show:1,top:-48,left:150}),b.focus())}}),b=$(".remind_add_tab #txt"),c=$(".remind_add_tab #data"),d=$(".remind_add_tab #private");
b.autosize().focus();c._calendar();d._check();$(".remind_add_tab #private_check").vkHint({msg:"Задание сможете<br />видеть только Вы.",top:-71,left:-11,indent:"left",delayShow:1E3})}).on("click","#zayavInfo .acc_add",function(){function a(){var a,d={op:"zayav_accrual_add",zayav_id:ZAYAV.id,sum:$("#sum").val(),prim:$("#prim").val(),status:$("#acc_status").val(),dev_status:$("#acc_dev_status").val(),remind:$("#acc_remind").val(),remind_txt:$("#reminder_txt").val(),remind_day:$("#reminder_day").val()};
REGEXP_NUMERIC.test(d.sum)?1!=d.remind||d.remind_txt?(b.process(),$.post(AJAX_WS,d,function(a){b.abort();a.success&&(b.close(),_msg("Начисление успешно произведено!"),$("._spisok._money").append(a.html),zayavInfoMoneyUpdate(a),a.status&&($("#status").html(a.status.name).css("background-color","#"+a.status.color),$("#status_dtime").html(a.status.dtime)),a.remind&&$("#remind_spisok").html(a.remind))},"json")):(a="Не указан текст напоминания",$("#reminder_txt").focus()):(a="Некорректно указана сумма.",
$("#sum").focus());a&&b.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",top:-48,left:123,indent:40,remove:1,show:1,correct:0})}var b=_dialog({top:60,width:420,head:"Заявка №"+ZAYAV.nomer+" - Начисление за выполненную работу",content:'<TABLE class="zayav_accrual_add"><tr><td class="label">Сумма: <TD><input type="text" id="sum" class="money" maxlength="5" /> руб.<tr><td class="label">Примечание:<em>(не обязательно)</em><TD><input type="text" id="prim" maxlength="100" /><tr><td class="label">Статус заявки: <TD><INPUT type="hidden" id="acc_status" value="2" /><tr><td class="label">Состояние устройства:<TD><INPUT type="hidden" id="acc_dev_status" value="5" /><tr><td class="label">Добавить напоминание:<TD><INPUT type="hidden" id="acc_remind" /></TABLE><TABLE class="zayav_accrual_add remind"><tr><td class="label">Содержание:<TD><input type="text" id="reminder_txt" value="Позвонить и сообщить о готовности."><tr><td class="label">Дата:<TD><INPUT type="hidden" id="reminder_day"></TABLE>',
submit:a});$("#sum").focus();$("#sum,#prim,#reminder_txt").keyEnter(a);$("#acc_status")._dropdown({spisok:STATUS});$("#acc_dev_status")._dropdown({spisok:DEVSTATUS_SPISOK});$("#acc_remind")._check();$("#acc_remind_check").click(function(a){$(".zayav_accrual_add.remind").toggle()});$("#reminder_day")._calendar()}).on("click","#zayavInfo .acc_del",function(){var a={op:"zayav_accrual_del",id:$(this).attr("val")},b=$(this).parent().parent();b.html('<td colspan="4" class="deleting">Удаление... <img src=/img/upload.gif></td>');
$.post(AJAX_WS,a,function(c){c.success&&(b.find(".deleting").html('Начисление удалено. <a class="acc_rest" val="'+a.id+'">Восстановить</a>'),zayavInfoMoneyUpdate(c))},"json")}).on("click","#zayavInfo .acc_rest",function(){var a={op:"zayav_accrual_rest",id:$(this).attr("val")},b=$(this),c=b.parent().parent();b.after("<img src=/img/upload.gif>").remove();$.post(AJAX_WS,a,function(a){a.success&&(c.after(a.html).remove(),zayavInfoMoneyUpdate(a))},"json")}).on("click","#zayavInfo .op_add",function(){function a(){var a,
d={op:"zayav_oplata_add",zayav_id:ZAYAV.id,sum:$("#sum").val(),kassa:$("#kassa").val(),prim:$.trim($("#prim").val()),dev_place:$("#dev_place").val()};REGEXP_NUMERIC.test(d.sum)?-1==d.kassa?a="Укажите, деньги поступили в кассу или нет.":(b.process(),$.post(AJAX_WS,d,function(a){b.abort();a.success&&(b.close(),_msg("Платёж успешно внесён!"),$("._spisok._money").append(a.html),zayavInfoMoneyUpdate(a))},"json")):(a="Некорректно указана сумма.",$("#sum").focus());a&&b.bottom.vkHint({msg:'<SPAN class="red">'+
a+"</SPAN>",remove:1,indent:40,show:1,top:-48,left:135})}var b=_dialog({top:60,width:440,head:"Заявка №"+ZAYAV.nomer+" - Внесение платежа",content:'<TABLE class="zayav_oplata_add"><TR><TD class="label">Сумма:<TD><input type="text" id="sum" class="money" maxlength="5"> руб.<TR><TD class="label">Деньги поступили в кассу?:<TD><input type="hidden" id="kassa" value="-1"><TR><TD class="label">Местонахождение устройства:<TD><input type="hidden" id="dev_place" value="2"><TR><TD class="label">Примечание:<em>(не обязательно)</em><TD><input type="text" id="prim"></TABLE>',
submit:a});$("#sum").focus();$("#sum,#prim").keyEnter(a);$("#kassa")._radio({spisok:[{uid:1,title:"да"},{uid:0,title:"нет"}]});$("#kassa_radio").vkHint({msg:'Если это наличный платёж<br />и деньги остаются в мастерской,<br />укажите "да".',top:-83,left:-60,delayShow:1E3});$("#dev_place")._dropdown({spisok:DEVPLACE_SPISOK})}).on("click","#zayavInfo .status_place",function(){var a=_dialog({width:400,top:30,head:"Изменение статуса заявки и состояния устройства",content:'<TABLE style="border-spacing:8px"><TR><TD class="label r topi">Статус заявки:<TD><input type="hidden" id="z_status" value="'+
ZAYAV.z_status+'"><TR><TD class="label r topi">Местонахождение устройства:<TD><input type="hidden" id="place" value="'+ZAYAV.dev_place+'"><TR><TD class="label r topi">Состояние устройства:<TD><input type="hidden" id="dev_status" value="'+ZAYAV.dev_status+'"></TABLE>',butSubmit:"Сохранить",submit:function(){var b,c={op:"zayav_status_place",zayav_id:ZAYAV.id,zayav_status:$("#z_status").val(),dev_status:$("#dev_status").val(),dev_place:$("#place").val(),place_other:$("#place_other").val()};0<c.dev_place&&
(c.place_other="");0==c.dev_place&&""==c.place_other?(b="Не указано местонахождение устройства",$("#place_other").focus()):0==c.dev_status?b="Не указано состояние устройства":(a.process(),$.post(AJAX_WS,c,function(b){b.success&&(a.close(),_msg("Изменения сохранены."),$("#status").html(b.z_status.name).css("background-color","#"+b.z_status.color),$("#status_dtime").html(b.z_status.dtime),$(".dev_status").html(b.dev_status),$(".dev_place").html(b.dev_place),ZAYAV.z_status=c.zayav_status,ZAYAV.dev_status=
c.dev_status,ZAYAV.dev_place=c.dev_place,ZAYAV.place_other=c.place_other)},"json"));b&&a.bottom.vkHint({msg:"<SPAN class=red>"+b+"</SPAN>",top:-47,left:103,indent:50,show:1,remove:1,correct:0})}});$("#z_status")._radio({spisok:STATUS,light:1});for(var b=[],c=0;c<DEVPLACE_SPISOK.length;c++)b.push(DEVPLACE_SPISOK[c]);b.push({uid:0,title:'другое: <INPUT type="text" id="place_other" '+(ZAYAV.place_other?"":'class="dn" ')+'maxlength="20" value="'+ZAYAV.place_other+'">'});$("#place")._radio({spisok:b,light:1,
func:function(a){$("#place_other")[(0==a?"remove":"add")+"Class"]("dn");0==a&&$("#place_other").val("").focus()}});$("#dev_status")._radio({spisok:DEVSTATUS_SPISOK,light:1})}).on("click","#zayavInfo .zakaz",function(){var a=$(this),b={op:"zayav_zp_zakaz",zayav_id:ZAYAV.id,zp_id:a.parent().parent().attr("val")};$.post(AJAX_WS,b,function(b){b.success&&(a.html("Заказано!").attr("class","zakaz_ok"),_msg(b.msg))},"json")}).on("click","#zayavInfo .zakaz_ok",function(){location.href=URL+"&p=zp&menu=3"}).on("click",
"#zayavInfo .zpAdd",function(){var a=_dialog({top:40,width:380,head:"Внесение новой запчасти",content:'<div class="zayav_zp_add"><CENTER>Добавление запчасти к устройству<br /><b>'+DEV_ASS[ZAYAV.device]+" "+VENDOR_ASS[ZAYAV.vendor]+" "+MODEL_ASS[ZAYAV.model]+'</b>.</CENTER><TABLE style="border-spacing:6px"><TR><TD class="label r">Наименование запчасти:<TD><input type="hidden" id="name_id"><TR><TD class="label r">Версия:<TD><input type="text" id="version" maxlength="30"><TR><TD class="label r">Цвет:<TD><input type="hidden" id="color_id"><TR><TD class="label r">Б/у:<TD><input type="hidden" id="bu"></TABLE></div>',
submit:function(){var b={op:"zayav_zp_add",zayav_id:ZAYAV.id,name_id:$("#name_id").val(),version:$("#version").val(),color_id:$("#color_id").val(),bu:$("#bu").val()};0==b.name_id?a.bottom.vkHint({msg:'<SPAN class="red">Не указано наименование запчасти.</SPAN>',top:-47,left:56,show:1,remove:1,correct:0}):(a.process(),$.post(AJAX_WS,b,function(b){b.success&&(_msg("Внесение запчасти произведено."),a.close(),$("#zpSpisok").append(b.html).find("._empty").remove())},"json"))}});$("#name_id")._select({width:200,
title0:"Наименование не выбрано",spisok:ZPNAME_SPISOK});$("#color_id")._select({width:130,title0:"Цвет не указан",spisok:COLOR_SPISOK});$("#bu")._check()}).on("click","#zayavInfo .set",function(){var a=$(this).parent().parent(),b='<CENTER class="zayav_zp_set">Установка запчасти<br />'+a.find("a:first").html()+".<br />"+(0<a.find(".color").length?a.find(".color").html()+".<br />":"")+"<br />Информация об установке также<br />будет добавлена в заметки к заявке.</CENTER>",c=_dialog({top:150,width:400,
head:"Установка запчасти",content:b,butSubmit:"Установить",submit:function(){var b={op:"zayav_zp_set",zp_id:a.attr("val"),zayav_id:ZAYAV.id};c.process();$.post(AJAX_WS,b,function(b){b.success&&(c.close(),_msg("Установка запчасти произведена."),a.after(b.zp_unit).remove(),$(".vkComment").after(b.comment).remove())},"json")}})}).on("click","#zp #bu_check",zpSpisokLoad).on("click","#zp ._next",function(){if(!$(this).hasClass("busy")){var a=$(this),b=zpFilter();b.op="zp_next";b.page=$(this).attr("val");
a.addClass("busy");$.post(AJAX_WS,b,function(b){b.success?a.after(b.spisok).remove():a.removeClass("busy")},"json")}}).on("click","#zp .avai_add",function(){for(var a=$(this);!a.hasClass("unit");)a=a.parent();var b={zp_id:a.attr("val"),name:a.find(".name").html(),"for":a.find(".for").html(),count:$(this).hasClass("avai")?$(this).find("b").html():0,img:a.find(".img").html(),callback:function(b){a.find(".avai_add").removeClass("hid").addClass("avai").html("В наличии: <b>"+b.count+"</b>")}};zpAvaiAdd(b);
$(".avaiAddTab img").attr("val")&&$(".avaiAddTab img").addClass("fotoView")}).on("mouseenter",".zpzakaz:not(.busy)",function(){window.zakaz_count=$(this).find("tt:first").next("b").html()}).on("mouseleave",".zpzakaz:not(.busy)",function(){var a=$(this),b=a.find("tt:first").next("b").html(),c=a;if(b!=window.zakaz_count){for(a.removeClass("hid").addClass("busy").find(".cnt").html("ано: <b></b>");!c.hasClass("unit");)c=c.parent();c={op:"zp_zakaz_edit",zp_id:c.attr("val"),count:b};$.post(AJAX_WS,c,function(c){a.removeClass("busy");
c.success&&(a.find(".cnt").html(0<b?"ано: <b>"+b+"</b>":"ать"),0==b&&a.addClass("hid"))},"json")}}).on("click",".zpzakaz tt",function(){var a=$(this),b=a.html(),a=a["+"==b?"prev":"next"](),c=a.html();"+"==b?c++:(c--,0>c&&(c=0));a.html(c)}).on("click","#zp .add",function(){var a=_dialog({top:70,width:380,head:"Внесение новой запчасти в каталог",content:'<table class="zp_add_dialog"><tr><td class="label">Наименование запчасти:<td><input type="hidden" id="name_id"><tr><td class="label top">Устройство:<td id="add_dev"><tr><td class="label">Версия:<td><input type="text" id="version"><tr><td class="label">Б/у:<td><input type="hidden" id="add_bu"><tr><td class="label">Цвет:<td><input type="hidden" id="color_id"></table>',
submit:function(){var b,c={op:"zp_add",name_id:$("#name_id").val(),device_id:$("#add_dev_device").val(),vendor_id:$("#add_dev_vendor").val(),model_id:$("#add_dev_model").val(),version:$("#version").val(),bu:$("#add_bu").val(),color_id:$("#color_id").val()};0==c.name_id?b="Не указано наименование запчасти.":0==c.device_id?b="Не выбрано устройство":0==c.vendor_id?b="Не выбран производитель":0==c.model_id?b="Не выбрана модель":(a.process(),$.post(AJAX_WS,c,function(b){a.abort();b.success&&(a.close(),
$("#zp_name")._select(c.name_id),$("#dev").device({width:153,type_no:1,device_ids:WS_DEVS,device_id:c.device_id,vendor_id:c.vendor_id,model_id:c.model_id,func:zpSpisokLoad}),zpSpisokLoad())},"json"));b&&a.bottom.vkHint({msg:'<SPAN class="red">'+b+"</SPAN>",left:110,top:-47,indent:50,show:1,remove:1})}});$("#name_id")._select({width:200,title0:"Наименование не выбрано",spisok:ZPNAME_SPISOK});$("#color_id")._select({width:130,title0:"Цвет не указан",spisok:COLOR_SPISOK});$("#add_bu")._check();$("#add_dev").device({width:200})}).on("click",
"#zpInfo .avai_add",function(){var a=ZP;a.zp_id=a.id;a.callback=zpAvaiUpdate;zpAvaiAdd(a);$(".avaiAddTab img").removeAttr("height").width(80)}).on("click","#zpInfo .edit",function(){var a=_dialog({top:30,width:380,head:"Редактирование запчасти",content:'<table class="zp_add_dialog"><tr><td class="label">Наименование запчасти:<td><input type="hidden" id="name_id" value="'+ZP.name_id+'"><tr><td class="label top">Устройство:<td id="add_dev"><tr><td class="label">Версия:<td><input type="text" id="version" value="'+
ZP.version+'"><tr><td class="label">Б/у:<td><input type="hidden" id="add_bu" value="'+ZP.bu+'"><tr><td class="label">Цвет:<td><input type="hidden" id="color_id" value="'+ZP.color_id+'"></table>',butSubmit:"Сохранить",submit:function(){var b,c={op:"zp_edit",zp_id:ZP.id,name_id:$("#name_id").val(),device_id:$("#add_dev_device").val(),vendor_id:$("#add_dev_vendor").val(),model_id:$("#add_dev_model").val(),version:$("#version").val(),bu:$("#add_bu").val(),color_id:$("#color_id").val()};0==c.name_id?b=
"Не указано наименование запчасти.":0==c.device_id?b="Не выбрано устройство":0==c.vendor_id?b="Не выбран производитель":0==c.model_id?b="Не выбрана модель":(a.process(),$.post(AJAX_WS,c,function(b){a.abort();b.success&&(a.close(),_msg("Редактирование данных произведено."),window.location.reload())},"json"));b&&a.bottom.vkHint({msg:'<SPAN class="red">'+b+"</SPAN>",left:110,top:-47,indent:50,show:1,remove:1})}});$("#name_id")._select({width:200,title0:"Наименование не выбрано",spisok:ZPNAME_SPISOK});
$("#color_id")._select({width:130,title0:"Цвет не указан",spisok:COLOR_SPISOK});$("#add_bu")._check();$("#add_dev").device({width:200,device_id:ZP.device,vendor_id:ZP.vendor,model_id:ZP.model})}).on("click","#zpInfo .set",function(){function a(){var a,d={op:"zayav_zp_set",zp_id:ZP.id,count:$("#count").val(),zayav_id:0<$("#zayavNomerId").length?$("#zayavNomerId").val():0,prim:$("#prim").val()};!REGEXP_NUMERIC.test(d.count)||d.count>ZP.count||0==d.count?(a="Некорректно указано количество.",$("#count").focus()):
0==d.zayav_id?(a="Не указан номер заявки.",$("#zayavNomer").focus()):(b.process(),$.post(AJAX_WS,d,function(a){b.abort();a.success&&(zpAvaiUpdate(),b.close(),_msg("Установка запчасти произведена."))},"json"));a&&b.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",left:74,top:-47,indent:50,show:1,remove:1})}if(!zpAvaiNo(ZP.count)){var b=_dialog({width:340,head:"Установка запчасти",content:'<table class="zp_dec_dialog"><tr><td class="label r">Количество:<td><input type="text" id="count" value="1"><span>(max: <b>'+
ZP.count+'</b>)</span><tr><td class="label r top">Номер заявки:<td><input type="text" id="zayavNomer"><tr><td class="label r top">Примечание:<td><textarea id="prim"></textarea></table>',submit:a});$("#count").focus().select()}}).on("click","#zpInfo .sale",function(){function a(){var a,d={op:"zp_sale",zp_id:ZP.id,count:$("#count").val(),cena:$("#cena").val(),kassa:$("#kassa").val(),client_id:$("#client_id").val(),prim:$("#prim").val()};!REGEXP_NUMERIC.test(d.count)||d.count>ZP.count||0==d.count?(a=
"Некорректно указано количество.",$("#count").focus()):REGEXP_CENA.test(d.cena)?"-1"==d.kassa?a="Укажите, поступили деньги в кассу или нет.":(b.process(),$.post(AJAX_WS,d,function(a){b.abort();a.success&&(zpAvaiUpdate(),b.close(),_msg("Продажа запчасти произведена."))},"json")):(a="Некорректно указана цена.",$("#cena").focus());a&&b.bottom.vkHint({msg:'<SPAN class="red">'+a+"</SPAN>",left:123,top:-47,indent:50,show:1,remove:1})}if(!zpAvaiNo(ZP.count)){var b=_dialog({top:40,width:440,head:"Продажа запчасти",
content:'<table class="zp_dec_dialog"><tr><td class="label r">Количество:<td><input type="text" id="count" value="1"><span>(max: <b>'+ZP.count+'</b>)</span><tr><td class="label r">Цена за ед.:<td><input type="text" id="cena" maxlength="8"> руб.<tr><td class="label r">Деньги поступили в кассу?:<td><input type="hidden" id="kassa" value="-1"><tr><td class="label r">Клиент:<td><input type="hidden" id="client_id"><tr><td class="label r top">Примечание:<td><textarea id="prim"></textarea></table>',submit:a});
$("#count").focus().select();$("#client_id").clientSel({add:1,width:240});$("#kassa")._radio({spisok:[{uid:1,title:"да"},{uid:0,title:"нет"}]})}}).on("click","#zpInfo .defect,#zpInfo .return,#zpInfo .writeoff",function(){function a(){var a={op:"zp_other",zp_id:ZP.id,type:d,count:$("#count").val(),prim:$("#prim").val()};!REGEXP_NUMERIC.test(a.count)||a.count>ZP.count||0==a.count?(e.bottom.vkHint({msg:'<SPAN class="red">Некорректно указано количество.</SPAN>',left:73,top:-47,indent:50,show:1,remove:1}),
$("#count").focus()):(e.process(),$.post(AJAX_WS,a,function(a){e.abort();a.success&&(zpAvaiUpdate(),e.close(),_msg(b[d]+" запчасти произвед"+c[d]+"."))},"json"))}if(!zpAvaiNo(ZP.count)){var b={defect:"Забраковка","return":"Возврат",writeoff:"Списание"},c={defect:"ена","return":"ён",writeoff:"ено"},d=$(this).attr("class"),e=_dialog({top:60,width:340,head:b[d]+" запчасти",content:'<table class="zp_dec_dialog"><tr><td class="label r">Количество:<td><input type="text" id="count" value="1"><span>(max: <b>'+
ZP.count+'</b>)</span><tr><td class="label r top">Примечание:<td><textarea id="prim"></textarea></table>',submit:a});$("#count").focus().select()}}).on("click","#zpInfo .move .img_del",function(){var a=$(this).attr("val"),b=_dialog({top:110,width:250,head:"Удаление заявки",content:"<center>Подтвердите удаление записи.</center>",butSubmit:"Удалить",submit:function(){var c={op:"zp_move_del",id:a};b.process();$.post(AJAX_WS,c,function(a){b.abort();a.success&&(zpAvaiUpdate(),b.close(),_msg("Запись удалена."))},
"json")}})}).on("click","#zpInfo .move ._next",function(){if(!$(this).hasClass("busy")){var a=$(this),b={op:"zp_move_next",zp_id:ZP.id,page:$(this).attr("val")};a.addClass("busy");$.post(AJAX_WS,b,function(b){b.success?a.after(b.spisok).remove():a.removeClass("busy")},"json")}}).on("click","#zpInfo .compat_add",function(){var a=ZP,b=_dialog({top:90,width:400,head:"Добавление совместимости с другими устройствами",content:'<div class="compatAddTab"><div class="name">'+(1==a.bu?'<span class="bu">Б/y</span>':
"")+a.name+"<br />"+a["for"]+'</div><table class="prop">'+(a.version?'<tr><td class="label">Версия:<td>'+a.version:"")+(0<a.color_id?'<tr><td class="label">Цвет:<td>'+a.color_name:"")+'</table><div class="headName">Подходит к устройству:</div><div id="dev"></div><div id="cres"></div></div>',butSubmit:"Добавить",submit:function(){if(0==e)b.bottom.vkHint({msg:'<SPAN class="red">Выберите устройство для добавления совместимости.</SPAN>',left:103,top:-47,indent:50,show:1,remove:1});else{var c={op:"zp_compat_add",
zp_id:a.id,device_id:d.device_id,vendor_id:d.vendor_id,model_id:d.model_id};b.process();$.post(AJAX_WS,c,function(a){b.abort();a.success&&(b.close(),_msg("Совместимость создана."),window.location.reload())},"json")}}}),c=$("#cres"),d={},e=0;$("#dev").device({width:220,device_id:a.device,vendor_id:a.vendor,add:1,func:function(f){b.abort();e=0;d=f;c.html("");0<f.device_id&&0<f.vendor_id&&0<f.model_id&&(f.device_id==a.device&&f.vendor_id==a.vendor&&f.model_id==a.model?c.html('<em class="red">Невозможно создать совместимость на это же устройство.</em>'):
(f={op:"zp_compat_find",zp_id:a.id,bu:a.bu,name_id:a.name_id,device_id:f.device_id,vendor_id:f.vendor_id,model_id:f.model_id,color_id:a.color_id},c.html('<img src="/img/upload.gif">'),$.post(AJAX_WS,f,function(b){c.html("");if(b.success)a:{if(b.id){if(b.compat_id==a.compat_id){c.html('<em class="red">Выбранная запчасть уже является совместимостью этой запчасти.</em>');break a}c.html("Запчасть <B>"+b.name+"</B><br />будет добавлена в совместимость.<br /><br />Информация о движениях, наличиях<br />и заказах будет сложена и станет<br />общей для обоих запчастей.")}else c.html("Запчасти <b>"+
b.name+"</b><br />нет в каталоге запчастей.<br /><br />При добавлении совместимости она<br />будет автоматически внесена в каталог.");e=1}},"json")))}})}).on("click","#zpInfo .compatSpisok .img_del",function(){var a=$(this).attr("val"),b=_dialog({top:110,width:250,head:"Удаление совместимости",content:"<center>Подтвердите удаление совместимости.</center>",butSubmit:"Удалить",submit:function(){var c={op:"zp_compat_del",id:a,zp_id:ZP.id};b.process();$.post(AJAX_WS,c,function(a){b.abort();a.success&&
(b.close(),_msg("Совместимость удалена."),$(".compatCount").html(a.count),$(".compatSpisok").html(a.spisok))},"json")}});return!1}).on("click","#history_next",function(){var a=$(this),b={op:"history_next",page:a.attr("val"),worker:$("#worker").val(),action:$("#action").val()};a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_WS,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json"))}).on("click",".remind_unit .hist_a",function(){$(this).parent().parent().find(".hist").slideToggle()}).on("click",
".report_remind_add",function(){var a=_dialog({top:30,width:480,head:"Добавление нового задания",content:'<TABLE class="remind_add_tab"><tr><td class="label">Назначение:<TD><INPUT type="hidden" id="destination" /><tr><td class="label topi" id="target_name"><TD id="target"></TABLE><TABLE class="remind_add_tab" id="tab_content"><tr><td class="label top">Задание:<TD><TEXTAREA id=txt></TEXTAREA><tr><td class="label">Крайний день выполнения:<TD><INPUT type="hidden" id="data" /><tr><td class="label">Личное:<TD><INPUT type="hidden" id="priv" /></TABLE>',
butSubmit:"Добавить",submit:function(){var b=1==$("#destination").val()?$("#client_id").val():0,c=0<$("#zayavNomerId").length?$("#zayavNomerId").val():0,b={op:"report_remind_add",client_id:b,zayav_id:c,txt:$("#txt").val(),day:$("#data").val(),"private":$("#priv").val()},d;0==$("#destination").val()?d="Не выбрано назначение.":1==$("#destination").val()&&0==b.client_id?d="Не выбран клиент.":2==$("#destination").val()&&0==b.zayav_id?(d="Не указан номер заявки.",$("#zayavNomer").focus()):b.txt?(a.process(),
$.post(AJAX_WS,b,function(b){b.success&&(a.close(),_msg("Новое задание успешно добавлено."),$(".left").html(b.html))},"json")):d="Не указано содержание напоминания.";d&&a.bottom.vkHint({msg:"<SPAN class=red>"+d+"</SPAN>",remove:1,indent:40,show:1,top:-48,left:150})}});$("#destination")._select({width:150,title0:"Не указано",spisok:[{uid:1,title:"Клиент"},{uid:2,title:"Заявка"},{uid:3,title:"Произвольное задание"}],func:function(a){$("#target").html("");$("#target_name").html("");$("#txt").val("");
$("#tab_content").css("display",0<a?"block":"none");1==a&&($("#target_name").html("Клиент:"),$("#target").html('<div id="client_id"></div>'),$("#client_id").clientSel());2==a&&($("#target_name").html("Номер заявки:"),$("#target").html('<input type="text" id="zayavNomer" />'),$("#zayavNomer").focus())}});$("#txt").autosize();$("#data")._calendar();$("#priv")._check();$("#priv_check").vkHint({msg:"Задание сможете<br />видеть только Вы.",top:-71,left:-11,indent:"left",delayShow:1E3});return!1}).on("click",
"#remind_next",function(){var a=$(this),b={op:"remind_next",page:$(this).attr("val"),status:$("#status").val(),"private":$("#private").val()};a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_WS,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json"))}).on("click",".remind_unit .edit",function(){var a=_dialog({top:30,width:400,head:"Новое действие для напоминания",load:1,butSubmit:"Применить",submit:function(){var d={op:"report_remind_edit",id:c,action:parseInt($("#action").val()),
day:b,status:1,history:$("#comment").val(),from_zayav:"undefined"==typeof ZAYAV?0:ZAYAV.id,from_client:window.CLIENT?CLIENT.id:0};switch(d.action){case 1:d.day=$("#data").val();break;case 2:d.status=2;break;case 3:d.status=0}var e;d.action?1!=d.action&&3!=d.action||d.history?1==d.action&&d.day==b?e="Выберите новую дату.":(a.process(),$.post(AJAX_WS,d,function(b){b.success&&(a.close(),_msg("Задание отредактировано."),$("#remind_spisok").html(b.html))},"json")):e="Не указана причина.":e="Укажите новое действие.";
e&&a.bottom.vkHint({msg:'<SPAN class="red">'+e+"</SPAN>",remove:1,indent:40,show:1,top:-48,left:115})}}),b,c=$(this).attr("val");$.post(AJAX_WS,{op:"report_remind_get",id:c},function(c){b=c.day;a.content.html('<TABLE class="remind_action_tab"><tr><td class="label">'+(c.client?"Клиент:":"")+(c.zayav?"Заявка:":"")+"<TD>"+(c.client?c.client:"")+(c.zayav?c.zayav:"")+'<tr><td class="label">Задание:<TD><B>'+c.txt+'</B><tr><td class="label">Внёс:<TD>'+c.viewer+", "+c.dtime+'<tr><td class="label top">Действие:<TD><INPUT type="hidden" id=action value="0"></TABLE><TABLE class="remind_action_tab" id="new_action"><tr><td class="label" id="new_about"><TD id="new_title"><tr><td class="label top" id="new_comm"><TD><TEXTAREA id="comment"></TEXTAREA></TABLE>');
$("#action")._radio({spisok:[{uid:1,title:"Перенести на другую дату"},{uid:2,title:"Выполнено"},{uid:3,title:"Отменить"}],func:function(a){$("#new_action").show();$("#comment").val("");$("#new_about").html("");$("#new_title").html("");1==a&&($("#new_about").html("Дата:"),$("#new_title").html('<INPUT type="hidden" id="data">'),$("#new_comm").html("Причина:"),$("#new_action #data")._calendar());2==a&&$("#new_comm").html("Комментарий:");3==a&&$("#new_comm").html("Причина:")}});$("#comment").autosize()},
"json")}).on("click","#income_next",function(){var a=$(this),b={op:"income_next",page:a.attr("val"),day:$(".selected").val(),del:$("#del").val()};a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_WS,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json"))}).on("click",".income .add",function(){var a=_dialog({width:380,head:"Внесение поступления средств",content:'<TABLE id="income-add-tab"><tr><td class="label">Содержание:<TD><INPUT type="text" id="about" maxlength="100"><tr><td class="label">Сумма:<TD><INPUT type="text" id="sum" class="money" maxlength="8"> руб.<tr><td class="label">Деньги поступили в кассу?:<TD><INPUT type="hidden" id="kassa" value="-1"></TABLE>',
submit:function(){var e={op:"income_add",about:d.val(),sum:c.val(),kassa:b.val()},f;e.about?REGEXP_NUMERIC.test(e.sum)?-1==e.kassa?f="Укажите, деньги поступили в кассу?":(a.process(),$.post(AJAX_WS,e,function(b){b.success&&(a.close(),_msg("Новое поступление внесено."),incomeSpisok())},"json")):(f="Некорректно указана сумма.",c.focus()):(f="Не указано содержание.",d.focus());f&&a.bottom.vkHint({msg:'<SPAN class="red">'+f+"</SPAN>",remove:1,indent:40,show:1,top:-53,left:103,correct:0})}}),b=$("#kassa"),
c=$("#sum"),d=$("#about");b._radio({spisok:[{uid:1,title:"да"},{uid:0,title:"нет"}]});d.focus()}).on("click",".income-del",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();if(!a.hasClass("deleting")){a.addClass("deleting");var b={op:"income_del",id:a.attr("val")};$.post(AJAX_WS,b,function(b){a.removeClass("deleting");b.success&&a.addClass("deleted")},"json")}}).on("click",".income-rest",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();var b={op:"income_rest",id:a.attr("val")};
$.post(AJAX_WS,b,function(b){b.success&&a.removeClass("deleted")},"json")}).on("click",".expense ._next",function(){var a=$(this),b={op:"expense_next",page:a.attr("val"),category:$("#category").val(),worker:$("#worker").val(),year:$("#year").val(),month:$("#monthSum").val()};a.hasClass("busy")||(a.addClass("busy"),$.post(AJAX_WS,b,function(b){b.success?a.after(b.html).remove():a.removeClass("busy")},"json"))}).on("click",".expense .add",function(){function a(a){c.bottom.vkHint({msg:'<SPAN class="red">'+
a+"</SPAN>",remove:1,indent:40,show:1,top:-47,left:103})}var b='<TABLE id="expense-add-tab"><tr><td class="label">Категория:<TD><INPUT type="hidden" id="expense_id" /><a href="'+URL+'&p=setup&d=expense" class="img_edit'+_tooltip("Настройка категорий расходов",-95)+'</a><tr class="tr-work dn"><td class="label">Сотрудник:<TD><INPUT type="hidden" id="worker_id" /><tr><td class="label">Описание:<TD><INPUT type="text" id="prim" maxlength="100"><tr><td class="label">Счёт:<TD><INPUT type="hidden" id="invoice_id" /><tr><td class="label">Сумма:<TD><INPUT type="text" id="sum" class="money" maxlength="11" /> руб.</TABLE>',
c=_dialog({width:380,head:"Внесение расхода",content:b,submit:function(){var b={op:"expense_add",expense_id:$("#expense_id").val(),worker_id:$("#worker_id").val(),prim:$("#prim").val(),invoice_id:$("#invoice_id").val(),sum:$("#sum").val()};b.prim||0!=b.expense_id?0==b.invoice_id?a("Укажите с какого счёта производится оплата."):REGEXP_CENA.test(b.sum)?(c.process(),$.post(AJAX_WS,b,function(a){a.success&&(c.close(),_msg("Новый расход внесён."),expenseSpisok())},"json")):(a("Некорректно указана сумма."),
$("#sum").focus()):(a("Выберите категорию или укажите описание."),$("#prim").focus())}});$("#expense_id")._select({width:200,title0:"Не указана",spisok:EXPENSE_SPISOK,func:function(a){$("#worker_id")._select(0);$(".tr-work")[(EXPENSE_WORKER[a]?"remove":"add")+"Class"]("dn")}});$("#worker_id")._select({width:200,title0:"Не выбран",spisok:WORKERS});$("#prim").focus();$("#invoice_id")._select({width:200,title0:"Не выбран",spisok:INVOICE_SPISOK,func:function(){$("#sum").focus()}})}).on("click",".expense .img_del",
function(){var a={op:"expense_del",id:$(this).attr("val")},b=$(this).parent().parent();b.html('<td colspan="4" class="deleting">Удаление... <img src=/img/upload.gif></td>');$.post(AJAX_WS,a,function(a){a.success&&(_msg("Удаление произведено."),b.remove())},"json")}).on("click",".expense .img_edit",function(){var a=_dialog({top:60,width:380,head:"Редактирование расхода",load:1,butSubmit:"Сохранить",submit:function(){var q={id:b,op:"expense_edit",category:c.val(),about:g.val(),worker:d.val(),sum:f.val(),
kassa:e.val()},p;q.about||0!=q.category?REGEXP_NUMERIC.test(q.sum)?-1==q.kassa?p="Укажите, деньги взяты из кассы или нет.":(a.process(),$.post(AJAX_WS,q,function(b){b.success&&(a.close(),_msg("Расход изменён."),expenseSpisok())},"json")):(p="Некорректно указана сумма.",f.focus()):(p="Выберите категорию или укажите описание.",g.focus());p&&a.bottom.vkHint({msg:'<SPAN class="red">'+p+"</SPAN>",remove:1,indent:40,show:1,top:-53,left:103,correct:0})}}),b=$(this).attr("val"),c,d,e,f,g;$.post(AJAX_WS,{op:"expense_get",
id:b},function(b){a.content.html('<TABLE id="expense-add-tab"><tr><td class="label">Категория:<TD><INPUT type="hidden" id="cat" value="'+b.category+'"><tr><td class="label">Описание:<TD><INPUT type="text" id="about" maxlength="150" value="'+b.about+'"><tr><td class="label">Сотрудник:<TD><INPUT type="hidden" id="work" value="'+b.worker_id+'"><tr><td class="label">Сумма:<TD><INPUT type="text" id="sum" class="money" maxlength="8" value="'+b.sum+'"> руб.<tr><td class="label">Деньги взяты из кассы?:<TD><INPUT type="hidden" id="kassa" value="'+
b.kassa+'"></TABLE>');c=$("#cat");d=$("#work");e=$("#kassa");f=$("#sum");g=$("#about");c._select({width:180,title0:"Не указана",spisok:EXPENSE_SPISOK,funcAdd:expenseCategoryAdd});d._select({title0:"Не выбран",spisok:WORKERS});e._radio({spisok:[{uid:1,title:"да"},{uid:0,title:"нет"}]});g.focus()},"json")}).on("click","#report_kassa #set_go",function(){if(!$(this).hasClass("busy")){var a=$(this),b=$("#set_summa"),c={op:"report_kassa_set",sum:b.val()};REGEXP_NUMERIC.test(c.sum)?(a.addClass("busy"),$.post(AJAX_WS,
c,function(b){b.success?location.reload():a.removeClass("busy")},"json")):(b.vkHint({msg:"<SPAN class=red>Некорректно введена сумма.</SPAN>",remove:1,indent:40,show:1,top:-70,left:16,correct:0}),b.focus())}}).on("click","#report_kassa_next",function(){if(!$(this).hasClass("busy")){var a=$(this),b={op:"report_kassa_next",page:$(this).attr("val")};a.addClass("busy");$.post(AJAX_WS,b,function(b){b.success?(a.remove(),$("#report_kassa ._spisok").append(b.html)):a.removeClass("busy")},"json")}}).on("click",
"#report_kassa .actions a:first",function(){var a=$("#kassa_summa"),b=parseInt(a.html()),c=_dialog({head:"Внесение денег в кассу",content:'<TABLE style="border-spacing:8px"><tr><td class="label r">Сумма:<TD><INPUT type="text" class="money" id="kassa_down_sum" maxlength="8" /><tr><td class="label r">Комментарий:<TD><INPUT type="text" id="kassa_down_txt" /></TABLE>',submit:function(){var f={op:"report_kassa_action",txt:e.val(),sum:d.val(),down:0},g;REGEXP_NUMERIC.test(f.sum)?f.txt?(c.process(),$.post(AJAX_WS,
f,function(d){d.success&&(c.close(),_msg("Новая запись внесёна."),a.html(b+=parseInt(f.sum)),reportKassaLoad())},"json")):(g="Не указан комментарий.",e.focus()):(g="Некорректно указана сумма.",d.focus());g&&c.bottom.vkHint({msg:'<SPAN class="red">'+g+"</SPAN>",remove:1,indent:40,show:1,top:-47,left:92,correct:0})}}),d=$("#kassa_down_sum"),e=$("#kassa_down_txt");d.focus()}).on("click","#report_kassa .actions a:last",function(){var a=$("#kassa_summa"),b=a.html(),c=_dialog({head:"Взятие денег из кассы",
content:'<TABLE style="border-spacing:8px"><tr><td class="label r">Сумма:<TD><INPUT type="text" class="money" id="kassa_down_sum" maxlength="8" /> max: '+b+'<tr><td class="label r">Комментарий:<TD><INPUT type="text" id="kassa_down_txt" /></TABLE>',submit:function(){var f={op:"report_kassa_action",txt:e.val(),sum:d.val(),down:1},g;REGEXP_NUMERIC.test(f.sum)?f.sum>b?(g="Введённая сумма превышает сумму в кассе.",d.focus()):f.txt?(c.process(),$.post(AJAX_WS,f,function(d){d.success&&(c.close(),_msg("Новая запись внесёна."),
a.html(b-=f.sum),reportKassaLoad())},"json")):(g="Не указан комментарий.",e.focus()):(g="Некорректно указана сумма.",d.focus());g&&c.bottom.vkHint({msg:'<SPAN class="red">'+g+"</SPAN>",remove:1,indent:40,show:1,top:-47,left:92,correct:0})}}),d=$("#kassa_down_sum"),e=$("#kassa_down_txt");d.focus()}).on("click","#report_kassa .img_del",function(){var a={op:"report_kassa_del",id:$(this).attr("val")},b=$(this).parent().parent(),c=b.html();b.html('<td colspan="4" class="deleting">Удаление... <img src=/img/upload.gif></td>');
$.post(AJAX_WS,a,function(a){a.success&&(_msg("Удаление произведено."),1==$("#kassaShowDel").val()?b.addClass("deleted").html(c).find(".img_del").attr("class","img_rest").attr("title","Восстановить"):b.remove(),$("#kassa_summa").html(a.sum))},"json")}).on("click","#report_kassa .img_rest",function(){var a={op:"report_kassa_rest",id:$(this).attr("val")},b=$(this).parent().parent(),c=b.html();b.html('<td colspan="4" class="deleting">Восстановление... <img src=/img/upload.gif></td>');$.post(AJAX_WS,
a,function(a){a.success&&(_msg("Восстановление произведено."),b.removeClass("deleted").html(c).find(".img_rest").attr("class","img_del").attr("title","Удалить платёж"),$("#kassa_summa").html(a.sum))},"json")}).on("click","#kassaShowDel_check",reportKassaLoad).ready(function(){$("#client").length&&(window.cFind=$("#find")._search({width:602,focus:1,enter:1,txt:"Начните вводить данные клиента",func:clientSpisok}),$("#buttonCreate").vkHint({msg:'<B>Внесение нового клиента в базу.</B><br /><br />После внесения Вы попадаете на страницу с информацией о клиенте для дальнейших действий.<br /><br />Клиентов также можно добавлять при <A href="'+
URL+'&p=zayav&d=add&back=client">создании новой заявки</A>.',ugol:"right",width:215,top:-38,left:-250,indent:40,delayShow:1E3,correct:0}).click(clientAdd),$("#dolg")._check(clientSpisok),$("#active")._check(clientSpisok),$("#comm")._check(clientSpisok),$("#dolg_check").vkHint({msg:"<b>Список должников.</b><br /><br />Выводятся клиенты, у которых баланс менее 0. Также в результате отображается общая сумма долга.",ugol:"right",width:150,top:-6,left:-185,indent:20,delayShow:1E3,correct:0}));$("#clientInfo").length&&
($("#dopLinks .link").click(function(){$("#dopLinks .link").removeClass("sel");$(this).addClass("sel");var a=$(this).attr("val");$(".res").css("display","zayav"==a?"block":"none");$("#zayav_filter").css("display","zayav"==a?"block":"none");$("#zayav_spisok").css("display","zayav"==a?"block":"none");$("#money_spisok").css("display","money"==a?"block":"none");$("#remind_spisok").css("display","remind"==a?"block":"none");$("#comments").css("display","comm"==a?"block":"none");$("#histories").css("display",
"hist"==a?"block":"none")}),$("#status").rightLink(clientZayavSpisok),$("#diff")._check(clientZayavSpisok),$("#dev").device({width:145,type_no:1,device_ids:DEVICE_IDS,vendor_ids:VENDOR_IDS,model_ids:MODEL_IDS,func:clientZayavSpisok}));if($("#zayav").length){window.zFind=$("#find").vkHint({msg:"Поиск производится по<br />совпадению в названии<br />модели, imei и серийном<br />номере.",ugol:"right",top:-9,left:-178,delayShow:800,correct:0})._search({width:153,focus:1,txt:"Быстрый поиск...",enter:1,
func:zayavSpisokLoad});zFind.inp(G.zayav_find);$("#desc")._check(zayavSpisokLoad);$("#status").rightLink(zayavSpisokLoad);$("#diff")._check(zayavSpisokLoad);$("#dev").device({width:155,type_no:1,device_id:G.zayav_device,vendor_id:G.zayav_vendor,model_id:G.zayav_model,device_ids:DEVICE_IDS,vendor_ids:VENDOR_IDS,model_ids:MODEL_IDS,func:zayavSpisokLoad});for(n=0;n<G.place_other.length;n++){var a=G.place_other[n];DEVPLACE_SPISOK.push({uid:encodeURI(a),title:a})}DEVPLACE_SPISOK.push({uid:-1,title:"не известно",
content:"<B>не известно</B>"});$("#device_place")._select({width:155,title0:"Любое местонахождение",spisok:DEVPLACE_SPISOK,func:zayavSpisokLoad});DEVSTATUS_SPISOK.splice(0,1);DEVSTATUS_SPISOK.push({uid:-1,title:"не известно",content:"<B>не известно</B>"});$("#devstatus")._select({width:155,title0:"Любое состояние",spisok:DEVSTATUS_SPISOK,func:zayavSpisokLoad});zayavFilter()}$("#zayavAdd").length&&($("#client_id").clientSel({add:1}),$("#dev").device({width:190,add:1,device_ids:WS_DEVS,func:zayavDevSelect}),
DEVPLACE_SPISOK.push({uid:0,title:'другое: <input type="text" id="place_other" class="dn" maxlength="20" />'}),$("#place")._radio({spisok:DEVPLACE_SPISOK,func:function(a){$("#place_other")[(0!=a?"add":"remove")+"Class"]("dn");0==a&&$("#place_other").val("").focus()}}),colorSelDop(0),$(document).on("click","#fault",function(){for(var a=$(this).find("INPUT"),c=[],d=0;d<a.length;d++)if(1==a.eq(d).val()){var e=a.eq(d).attr("id").split("_")[1];c.push(FAULT_ASS[e])}$("#comm").val(c.join(", "))}),$("#comm").autosize(),
$("#reminder_check").click(function(a){$("#reminder_tab").toggle();$("#reminder_txt").focus()}),$("#reminder_day")._calendar(),$(".vkCancel").click(function(){location.href=URL+"&p="+$(this).attr("val")}),$(".vkButton").click(function(){if(!$(this).hasClass("busy")){var a={op:"zayav_add",client:$("#client_id").val(),device:$("#dev_device").val(),vendor:$("#dev_vendor").val(),model:$("#dev_model").val(),equip:"",place:$("#place").val(),place_other:$("#place_other").val(),imei:$("#imei").val(),serial:$("#serial").val(),
color:$("#color_id").val(),color_dop:$("#color_dop").val(),comm:$("#comm").val(),reminder:$("#reminder").val()};if(!$(".tr_equip").hasClass("dn")){for(var c=$(".equip_spisok input"),d=[],e=0;e<c.length;e++){var f=c.eq(e);1==f.val()&&d.push(f.attr("id").split("_")[1])}a.equip=d.join()}a.reminder_txt=1==a.reminder?$("#reminder_txt").val():"";a.reminder_day=1==a.reminder?$("#reminder_day").val():"";c="";0==a.client?c="Не выбран клиент":0==a.device?c="Не выбрано устройство":"-1"==a.place||0==a.place&&
!a.place_other?c="Не указано местонахождение устройства":1!=a.reminder||a.reminder_txt?(0<a.place&&(a.place_other=""),$(this).addClass("busy"),$.post(AJAX_WS,a,function(a){location.href=URL+"&p=zayav&d=info&id="+a.id},"json")):c="Не указан текст напоминания";c&&$(this).vkHint({msg:'<SPAN class="red">'+c+"</SPAN>",top:-48,left:201,indent:30,remove:1,show:1,correct:0})}}));$("#zayavInfo").length&&($(".delete").vkHint({msg:"Заявку можно удалить при отсутствии платежей и начислений. Также удаляются все задачи к этой заявке.",
width:150,ugol:"top",top:40,left:456,indent:90,correct:0}),$(".fotoUpload").fotoUpload({owner:"zayav"+ZAYAV.id,func:zayavImgUpdate}),$(".img_print").click(function(){_dialog({width:380,top:30,head:"Заявка №"+ZAYAV.nomer+" - Печать квитанции",content:'<table class="zayav-print"><tr><td class="label">Дата приёма:<td>'+PRINT.dtime+'<tr><td class="label top">Устройство:<td>'+PRINT.device+(PRINT.color?'<tr><td class="label">Цвет:<td>'+PRINT.color:"")+(PRINT.imei?'<tr><td class="label">IMEI:<td>'+PRINT.imei:
"")+(PRINT.serial?'<tr><td class="label">Серийный номер:<td>'+PRINT.serial:"")+(PRINT.equip?'<tr><td class="label">Комплектация:<td>'+PRINT.equip:"")+'<tr><td class="label">Заказчик:<td><b>'+PRINT.client+"</b>"+(PRINT.telefon?'<tr><td class="label">Телефон:<td>'+PRINT.telefon:"")+'<tr><td class="label top">Неисправность:<td><textarea id="defect">'+PRINT.defect+"</textarea></table>",butSubmit:"",submit:function(){}});$("#defect").focus().autosize()}));$("#zp").length&&($("#find")._search({width:153,
focus:1,txt:"Быстрый поиск...",enter:1,func:zpSpisokLoad}).inp(G.zp_find),$("#menu_rightLink a").click(function(){$("#menu").rightLink($(this).attr("val"));zpSpisokLoad()}),$("#zp_name")._select({width:153,title0:"Любое наименование",spisok:ZPNAME_SPISOK,func:zpSpisokLoad}).o,$("#dev").device({width:153,type_no:1,device_ids:WS_DEVS,device_id:G.zp_device,vendor_id:G.zp_vendor,model_id:G.zp_model,func:zpSpisokLoad}),zpFilter());$("#zpInfo").length&&$(".fotoUpload").fotoUpload({owner:"zp"+ZP.compat_id,
func:zpImgUpdate});$("#report.history").length&&($("#worker")._select({width:140,title0:"Не указан",spisok:WORKERS,func:historySpisok}),$("#action")._select({width:140,title0:"Не выбрано",spisok:[{uid:1,title:"Клиенты"},{uid:2,title:"Заявки"},{uid:3,title:"Запчасти"},{uid:4,title:"Платежи"}],func:historySpisok}));$("#report.remind").length&&($("#status")._radio(remindSpisok),$("#private")._check(remindSpisok));$("#report.income").length&&(window._calendarFilter=incomeSpisok,$("#del")._check(incomeSpisok));
$("#report.expense").length&&($("#category")._select({width:140,title0:"Любая категория",spisok:EXPENSE_SPISOK,func:expenseSpisok}),$("#worker")._select({width:140,title0:"Все сотрудники",spisok:WORKERS,func:expenseSpisok}),$("#year").years({func:expenseSpisok}),$("#monthSum")._radio(expenseSpisok))});
