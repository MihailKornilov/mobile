$(document).on("click",".sa-user .action",function(){for(var a=$(this),b=a;!b.hasClass("un");)b=b.parent();b={op:"user_action",viewer_id:b.attr("val")};a.html("&nbsp;").addClass("_busy");$.post(AJAX_MAIN,b,function(b){b.success?a.after(b.html).remove():a.html("Действие").removeClass("_busy")},"json")}).on("click",".sa-ws-info .ws_status_change",function(){var a=$(this),b={op:"ws_status_change",ws_id:a.attr("val")};$.post(AJAX_MAIN,b,function(b){b.success?document.location.reload():a.vkHint({msg:"<SPAN class=red>"+
b.text+"</SPAN>",top:-47,left:27,indent:50,show:1,remove:1})},"json")}).on("click",".sa-ws-info .ws_enter",function(){_cookie("sa_viewer_id",$(this).attr("val"));document.location.reload()}).on("click",".sa-ws-info .ws_del",function(){var a=$(this);_dialog({top:110,width:250,head:"Удаление организации",content:"<center>Подтвердите удаление организации.</center>",butSubmit:"Удалить",submit:function(){var b={op:"ws_del",ws_id:a.attr("val")};$.post(AJAX_MAIN,b,function(b){b.success&&document.location.reload()},
"json")}})}).on("click",".sa-ws-info .ws_client_balans",function(){var a=$(this),b={op:"ws_client_balans",ws_id:a.attr("val")};a.addClass("busy");$.post(AJAX_MAIN,b,function(b){a.removeClass("busy");b.success&&(a.next().remove("span"),a.after("<span> Изменено: "+b.count+". Время: "+b.time+"</span>"))},"json")}).on("click",".sa-ws-info .ws_zayav_balans",function(){var a=$(this),b={op:"ws_zayav_balans",ws_id:a.attr("val")};a.addClass("busy");$.post(AJAX_MAIN,b,function(b){a.removeClass("busy");b.success&&
(a.next().remove("span"),a.after("<span> Изменено: "+b.count+". Время: "+b.time+"</span>"))},"json")}).on("click","#sa-tovar-category .add",function(){function a(){var a={op:"tovar_category_add",name:$("#name").val()};a.name?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?($("#spisok").html(a.html),b.close(),_msg("Внесено!"),sortable()):b.abort()},"json")):(b.err("Не указано наименование"),$("#name").focus())}$(this);var b=_dialog({width:390,head:"Добавление новой категории товара",content:'<table class="sa-tab"><tr><td class="label r">Наименование:<td><input id="name" type="text" /></table>',
submit:a});$("#name").keyEnter(a).focus()}).on("click","#sa-tovar-category .img_edit",function(){function a(){var a={op:"tovar_category_edit",id:b.attr("val"),name:$("#name").val()};a.name?(d.process(),$.post(AJAX_MAIN,a,function(b){b.success?($("#spisok").html(b.html),d.close(),_msg("Сохранено"),sortable()):d.abort()},"json")):(d.err("Не указано наименование"),$("#name").focus())}for(var b=$(this);"TR"!=b[0].tagName;)b=b.parent();var c='<table class="sa-tab"><tr><td class="label r">Наименование:<td><input id="name" type="text" value="'+
b.find(".name").html()+'" /></table>',d=_dialog({width:390,head:"Редактирование категории товара",content:c,butSubmit:"Сохранить",submit:a});$("#name").keyEnter(a).focus()}).on("click","#sa-tovar-category .img_add",function(){for(var a=$(this);"TR"!=a[0].tagName;)a=a.parent();var b='<table class="sa-tab"><tr><td class="label">Категория:<td><b>'+a.find(".name").html()+'</b><tr><td class="label">Устройство:<td><input type="hidden" id="device_id" /></table>',c=_dialog({width:390,head:"Прикрепление устройства к категории товара",
content:b,butSubmit:"Прикрепить",submit:function(){var b={op:"tovar_category_device_add",id:a.attr("val"),device_id:_num($("#device_id").val())};b.device_id?(c.process(),$.post(AJAX_MAIN,b,function(b){b.success?($("#spisok").html(b.html),c.close(),_msg("Сохранено"),sortable()):c.abort()},"json")):c.err("Не выбрано устройство")}});$("#device_id")._select({width:250,title0:"не выбрано",spisok:[]})._select("process");$.post(AJAX_MAIN,{op:"tovar_category_device_load"},function(b){b.success?$("#device_id")._select(b.dev):
$("#device_id")._select([])},"json")}).on("click",".sa-device .add",function(){function a(){for(var a=$(".equip input"),d=[],e=0;e<a.length;e++){var f=a.eq(e);1==f.val()&&d.push(f.attr("id").split("_")[1])}a={op:"device_add",name:$("#name").val(),rod:$("#name_rod").val(),mn:$("#name_mn").val(),equip:d.join()};a.name&&a.rod&&a.mn?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?($(".spisok").html(a.html),b.close(),_msg("Внесено!"),sortable()):b.abort()},"json")):(b.bottom.vkHint({msg:"<SPAN class=red>Необходимо заполнить все поля</SPAN>",
top:-47,left:131,indent:50,show:1,remove:1}),a.name?a.rod?a.mn||$("#name_mn").focus():$("#name_rod").focus():$("#name").focus())}$(this);var b=_dialog({top:60,width:460,head:"Добавление нового наименования устройства",content:'<table class="sa-device-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" /><tr><td class="label r">Родительный падеж (кого?):<td><input id="name_rod" type="text" maxlength="100" /><tr><td class="label r">Множественное число:<td><input id="name_mn" type="text" maxlength="100" /><tr><td class="label r top">Возможная комплектация:<td class="equip">'+
devEquip+"</table>",submit:a});$("#name,#name_rod,#name_mn").keyEnter(a);$("#name").focus()}).on("click",".sa-device .img_edit",function(){function a(){for(var a=$(".equip input"),e=[],f=0;f<a.length;f++){var g=a.eq(f);1==g.val()&&e.push(g.attr("id").split("_")[1])}a={op:"device_edit",id:b,name:$("#name").val(),rod:$("#name_rod").val(),mn:$("#name_mn").val(),equip:e.join()};a.name&&a.rod&&a.mn?(c.process(),$.post(AJAX_MAIN,a,function(b){b.success?($(".spisok").html(b.html),c.close(),_msg("Изменено!"),
sortable()):c.abort()},"json")):(c.bottom.vkHint({msg:"<SPAN class=red>Необходимо заполнить все поля</SPAN>",top:-47,left:131,indent:50,show:1,remove:1}),a.name?a.rod?a.mn||$("#name_mn").focus():$("#name_rod").focus():$("#name").focus())}for(var b=$(this),c=_dialog({top:60,width:460,head:"Изменение данных устройства",load:1,butSubmit:"Сохранить",submit:a});"DD"!=b[0].tagName;)b=b.parent();b=b.attr("val");$.post(AJAX_MAIN,{op:"device_get",id:b},function(b){b.success?(c.content.html('<table class="sa-device-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" value="'+
b.name+'" /><tr><td class="label r">Родительный падеж (кого?):<td><input id="name_rod" type="text" maxlength="100" value="'+b.name_rod+'" /><tr><td class="label r">Множественное число:<td><input id="name_mn" type="text" maxlength="100" value="'+b.name_mn+'" /><tr><td class="label r top">Возможная комплектация:<td class="equip">'+b.equip+"</table>"),$("#name,#name_rod,#name_mn").keyEnter(a),$("#name").focus()):c.loadError()},"json")}).on("click",".sa-device .img_del",function(){var a=$(this),b=_dialog({top:90,
width:300,head:"Удаление устройства",content:"<center><b>Подтвердите удаление устройства.</b></center>",butSubmit:"Удалить",submit:function(){for(;"DD"!=a[0].tagName;)a=a.parent();var c={op:"device_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?($(".spisok").html(a.html),b.close(),_msg("Удалено!"),sortable()):b.abort()},"json")}})}).on("click",".sa-vendor .add",function(){function a(){var a={op:"vendor_add",device_id:DEVICE_ID,name:$("#name").val(),bold:$("#bold").val()};
a.name?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?($(".spisok").html(a.html),b.close(),_msg("Внесено!"),sortable()):b.abort()},"json")):(b.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:99,indent:50,show:1,remove:1}),$("#name").focus())}$(this);var b=_dialog({top:60,width:390,head:"Добавление нового наименования производителя",content:'<table class="sa-vendor-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" /><tr><td class="label r">Выделить:<td><input id="bold" type="hidden" /></table>',
submit:a});$("#name").focus().keyEnter(a);$("#bold")._check()}).on("click",".sa-vendor .img_edit",function(){function a(){var a={op:"vendor_edit",vendor_id:b.attr("val"),name:$("#name").val(),bold:$("#bold").val()};a.name?(d.process(),$.post(AJAX_MAIN,a,function(b){b.success?($(".spisok").html(b.html),d.close(),_msg("Изменено!"),sortable()):d.abort()},"json")):(d.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:99,indent:50,show:1,remove:1}),$("#name").focus())}for(var b=
$(this);"DD"!=b[0].tagName;)b=b.parent();var c=b.find(".name").hasClass("b")?1:0,c='<table class="sa-vendor-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" value="'+b.find(".name a").html()+'" /><tr><td class="label r">Выделить:<td><input id="bold" type="hidden" value="'+c+'" /></table>',d=_dialog({top:60,width:390,head:"Изменение данных производителя",content:c,butSubmit:"Сохранить",submit:a});$("#name").focus().keyEnter(a);$("#bold")._check()}).on("click",
".sa-vendor .img_del",function(){var a=$(this),b=_dialog({top:90,width:300,head:"Удаление производителя",content:"<center><b>Подтвердите удаление производителя.</b></center>",butSubmit:"Удалить",submit:function(){for(;"DD"!=a[0].tagName;)a=a.parent();var c={op:"vendor_del",vendor_id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?($(".spisok").html(a.html),b.close(),_msg("Удалено!"),sortable()):b.abort()},"json")}})}).on("click",".sa-model ._next",function(){var a=$(this);if(!a.hasClass("busy")){var b=
{op:"model_spisok",vendor_id:VENDOR_ID,page:a.attr("val"),find:$("#find")._search("val")};a.addClass("busy");$.post(AJAX_MAIN,b,function(b){b.success?(a.parent().remove(),$("._spisok").append(b.html)):a.removeClass("busy")},"json")}}).on("click",".sa-model .add",function(){function a(){var a={op:"model_add",vendor_id:VENDOR_ID,name:$("#name").val()};a.name?(c.process(),$.post(AJAX_MAIN,a,function(a){a.success?($("._spisok").find(".tr").remove().end().append(a.html),c.close(),_msg("Внесено!")):(c.abort(),
b(a.text))},"json")):b("Не указано наименование")}function b(a){c.bottom.vkHint({msg:"<SPAN class=red>"+a+"</SPAN>",top:-47,left:99,indent:50,show:1,remove:1});$("#name").focus()}$(this);var c=_dialog({top:60,width:390,head:"Добавление нового наименования модели",content:'<table class="sa-model-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" /></table>',submit:a});$("#name").focus().keyEnter(a)}).on("click",".sa-model .img_edit",function(){function a(){var a=
{op:"model_edit",model_id:b.attr("val"),name:$("#name").val()};a.name?(d.process(),$.post(AJAX_MAIN,a,function(c){c.success?(b.find(".name b").html(a.name),d.close(),_msg("Изменено!")):d.abort()},"json")):(d.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:99,indent:50,show:1,remove:1}),$("#name").focus())}for(var b=$(this);"TR"!=b[0].tagName;)b=b.parent();var c='<table class="sa-model-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" value="'+
b.find(".name .dn").html()+'" /></table>',d=_dialog({top:60,width:390,head:"Изменение данных модели",content:c,butSubmit:"Сохранить",submit:a});$("#name").focus().keyEnter(a)}).on("click",".sa-model ._spisok .img_del",function(){var a=$(this),b=_dialog({top:90,width:300,head:"Удаление модели",content:"<center><b>Подтвердите удаление модели.</b></center>",butSubmit:"Удалить",submit:function(){for(;"TR"!=a[0].tagName;)a=a.parent();var c={op:"model_del",model_id:a.attr("val")};b.process();$.post(AJAX_MAIN,
c,function(c){c.success?(a.remove(),b.close(),_msg("Удалено!")):b.abort()},"json")}})}).on("click",".sa-equip .rightLink a",function(){$(".sa-equip .rightLink a.sel").removeClass("sel");$(this).addClass("sel");ZPNAME.device_id=$(".sa-equip .rightLink .sel").attr("val");var a={op:"equip_show",device_id:ZPNAME.device_id};$("#eq-spisok").addClass("dis");$("#zp-spisok").addClass("dis");$.post(AJAX_MAIN,a,function(a){$("#eq-spisok").removeClass("dis").html(a.equip);$("#zp-spisok").removeClass("dis").html(a.zp);
sortable()},"json")}).on("click",".sa-equip #equip-add",function(){function a(){var a={op:"equip_add",name:$("#name").val(),device_id:$(".sa-equip .rightLink .sel").attr("val")};a.name?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?($("#eq-spisok").html(a.html),b.close(),_msg("Внесено"),sortable()):b.abort()},"json")):(b.err("Не указано наименование"),$("#name").focus())}$(this);var b=_dialog({top:90,width:350,head:"Добавление новой комплектации",content:'<table class="sa-equip-add"><tr><td class="label">Наименование:<td><input id="name" type="text" maxlength="100" /></table>',
submit:a});$("#name").keyEnter(a).focus()}).on("click",".sa-equip .equip-edit",function(){function a(){var a={op:"equip_edit",id:c,name:$("#name").val()};a.name?(e.process(),$.post(AJAX_MAIN,a,function(c){c.success?(b.find(".name").html(a.name),e.close(),_msg("Сохранено!")):e.abort()},"json")):(e.err("Не указано наименование"),$("#name").focus())}for(var b=$(this);"DD"!=b[0].tagName;)b=b.parent();var c=b.attr("val"),d='<table class="sa-equip-add"><tr><td class="label">Наименование:<td><input id="name" type="text" maxlength="100" value="'+
b.find(".name").html()+'" /></table>',e=_dialog({top:90,width:350,head:"Редактирование комплектации",content:d,butSubmit:"Сохранить",submit:a});$("#name").keyEnter(a).focus()}).on("click",".sa-equip .equip-del",function(){var a=$(this),b=_dialog({top:90,width:300,head:"Удаление комплектации",content:"<center><b>Подтвердите удаление комплектации.</b></center>",butSubmit:"Удалить",submit:function(){for(;"DD"!=a[0].tagName;)a=a.parent();var c={op:"equip_del",id:a.attr("val"),device_id:$(".sa-equip .rightLink .sel").attr("val")};
b.process();$.post(AJAX_MAIN,c,function(a){a.success?($("#eq-spisok").html(a.html),b.close(),_msg("Удалено!"),sortable()):b.abort()},"json")}})}).on("click",".sa-equip .check0,.sa-equip .check1",function(){for(var a=$(".sa-equip ._sort input"),b=[],c=0;c<a.length;c++){var d=a.eq(c);1==d.val()&&b.push(d.attr("id").split("_")[1])}a={op:"equip_set",device_id:$(".sa-equip .rightLink .sel").attr("val"),ids:b.join()};$(".path").addClass("busy");$.post(AJAX_MAIN,a,function(a){$(".path").removeClass("busy")},
"json")}).on("click","#zpname-add",zpNameAdd).on("click",".zpname-edit",function(){function a(){var a={op:"zpname_edit",id:b.attr("val"),name:$("#name").val()};a.name?(d.process(),$.post(AJAX_MAIN,a,function(c){c.success?(b.find(".name").html(a.name),d.close(),_msg("Изменено.")):d.abort()},"json")):(d.err("Не указано наименование"),$("#name").focus())}for(var b=$(this);"TR"!=b[0].tagName;)b=b.parent();var c='<table class="sa-tab"><tr><td class="label">Наименование:<td><input id="name" type="text" maxlength="100" value="'+
b.find(".name").html()+'" /></table>',d=_dialog({width:390,head:"Редактирование",content:c,butSubmit:"Сохранить",submit:a});$("#name").keyEnter(a).focus()}).on("click",".zpname-del",function(){var a=$(this),b=_dialog({top:90,width:300,head:"Удаление",content:"<center><b>Подтвердите удаление наименования запчасти.</b></center>",butSubmit:"Удалить",submit:function(){for(;"TR"!=a[0].tagName;)a=a.parent();var c={op:"zpname_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?($("#zp-spisok").html(a.html),
b.close(),_msg("Удалено!")):b.abort()},"json")}})}).on("click",".sa-fault .add",function(){function a(){var a={op:"fault_add",name:$("#name").val()};a.name?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?($(".spisok").html(a.html),b.close(),_msg("Внесено!"),sortable()):b.abort()},"json")):(b.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:99,indent:50,show:1,remove:1}),$("#name").focus())}var b=_dialog({width:390,head:"Добавление новой неисправности",content:'<table class="sa-tab"><tr><td class="label">Наименование:<td><input id="name" type="text" maxlength="100" /></table>',
submit:a});$("#name").focus().keyEnter(a)}).on("click",".sa-fault .img_edit",function(){function a(){var a={op:"fault_edit",id:b.attr("val"),name:$("#name").val()};a.name?(d.process(),$.post(AJAX_MAIN,a,function(a){a.success?($(".spisok").html(a.html),d.close(),_msg("Изменено."),sortable()):d.abort()},"json")):(d.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:57,indent:50,show:1,remove:1}),$("#name").focus())}for(var b=$(this);"DD"!=b[0].tagName;)b=b.parent();var c=
'<table class="sa-tab"><tr><td class="label">Наименование:<td><input id="name" type="text" maxlength="100" value="'+b.find(".name").html()+'" /></table>',d=_dialog({width:390,head:"Редактирование неисправности",content:c,butSubmit:"Сохранить",submit:a});$("#name").keyEnter(a).focus()}).on("click",".sa-fault .img_del",function(){var a=$(this),b=_dialog({top:90,width:300,head:"Удаление неисправности",content:"<center><b>Подтвердите удаление неисправности.</b></center>",butSubmit:"Удалить",submit:function(){for(;"DD"!=
a[0].tagName;)a=a.parent();var c={op:"fault_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?($(".spisok").html(a.html),b.close(),_msg("Удалено!"),sortable()):b.abort()},"json")}})}).on("click",".sa-color .add",function(){function a(){var a={op:"color_add",predlog:$("#predlog").val(),name:$("#name").val()};a.predlog?a.name?(c.process(),$.post(AJAX_MAIN,a,function(a){a.success?($(".spisok").html(a.html),c.close(),_msg("Внесено!")):c.abort()},"json")):(b("Не указан цвет"),
$("#name").focus()):(b("Не указан предлог"),$("#predlog").focus())}function b(a){c.bottom.vkHint({msg:"<SPAN class=red>"+a+"</SPAN>",top:-47,left:57,indent:50,show:1,remove:1})}var c=_dialog({top:90,width:310,head:"Добавление нового цвета",content:'<table class="sa-color-add"><tr><td class="label">Предлог:<td><input id="predlog" type="text" maxlength="100" /><tr><td class="label">Цвет:<td><input id="name" type="text" maxlength="100" /></table>',submit:a});$("#name,#predlog").keyEnter(a);$("#predlog").focus()}).on("click",
".sa-color .img_edit",function(){function a(){var a={op:"color_edit",id:c.attr("val"),predlog:$("#predlog").val(),name:$("#name").val()};a.predlog?a.name?(f.process(),$.post(AJAX_MAIN,a,function(a){a.success?($(".spisok").html(a.html),f.close(),_msg("Изменено.")):f.abort()},"json")):(b("Не указан цвет"),$("#name").focus()):(b("Не указан предлог"),$("#predlog").focus())}function b(a){f.bottom.vkHint({msg:"<SPAN class=red>"+a+"</SPAN>",top:-47,left:57,indent:50,show:1,remove:1})}for(var c=$(this);"TR"!=
c[0].tagName;)c=c.parent();var d=c.find(".pre").html(),e=c.find(".name").html(),f=_dialog({top:90,width:310,head:"Редактирование цвета",content:'<table class="sa-color-add"><tr><td class="label">Предлог:<td><input id="predlog" type="text" maxlength="100" value="'+d+'" /><tr><td class="label">Цвет:<td><input id="name" type="text" maxlength="100" value="'+e+'" /></table>',butSubmit:"Сохранить",submit:a});$("#name,#predlog").keyEnter(a);$("#predlog").focus()}).on("click",".sa-color .img_del",function(){var a=
$(this),b=_dialog({top:90,width:300,head:"Удаление цвета",content:"<center><b>Подтвердите удаление цвета.</b></center>",butSubmit:"Удалить",submit:function(){for(;"TR"!=a[0].tagName;)a=a.parent();var c={op:"color_del",id:a.attr("val")};b.process();$.post(AJAX_MAIN,c,function(a){a.success?($(".spisok").html(a.html),b.close(),_msg("Удалено!")):b.abort()},"json")}})}).ready(function(){$(".sa-model").length&&$("#find")._search({width:300,txt:"Поиск по названию модели",enter:1,focus:1,func:function(a){var b=
$(".path");b.hasClass("busy")||(a={op:"model_spisok",vendor_id:VENDOR_ID,find:escape(a)},b.addClass("busy"),$.post(AJAX_MAIN,a,function(a){b.removeClass("busy");a.success&&$(".spisok").html(a.html)},"json"))}})});
