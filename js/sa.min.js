var AJAX_SA=SITE+"/ajax/sa.php?"+VALUES;
$(document).on("click",".sa-ws-info .ws_status_change",function(){var a=$(this),b={op:"ws_status_change",ws_id:a.attr("val")};$.post(AJAX_SA,b,function(b){b.success?document.location.reload():a.vkHint({msg:"<SPAN class=red>"+b.text+"</SPAN>",top:-47,left:27,indent:50,show:1,remove:1})},"json")}).on("click",".sa-ws-info .ws_enter",function(){setCookie("sa_viewer_id",$(this).attr("val"));document.location.reload()}).on("click",".sa-ws-info .ws_del",function(){var a=$(this);_dialog({top:110,width:250,
head:"Удаление мастерской",content:"<center>Подтвердите удаление мастерской.</center>",butSubmit:"Удалить",submit:function(){var b={op:"ws_del",ws_id:a.attr("val")};$.post(AJAX_SA,b,function(b){b.success&&document.location.reload()},"json")}})}).on("click",".sa-ws-info .ws_client_balans",function(){var a=$(this),b={op:"ws_client_balans",ws_id:a.attr("val")};a.addClass("busy");$.post(AJAX_SA,b,function(b){a.removeClass("busy");b.success&&(a.next().remove("span"),a.after("<span> Изменено: "+b.count+
". Время: "+b.time+"</span>"))},"json")}).on("click",".sa-ws-info .ws_zayav_balans",function(){var a=$(this),b={op:"ws_zayav_balans",ws_id:a.attr("val")};a.addClass("busy");$.post(AJAX_SA,b,function(b){a.removeClass("busy");b.success&&(a.next().remove("span"),a.after("<span> Изменено: "+b.count+". Время: "+b.time+"</span>"))},"json")}).on("click",".sa-device .add",function(){function a(){for(var a=$(".equip input"),d=[],e=0;e<a.length;e++){var f=a.eq(e);1==f.val()&&d.push(f.attr("id").split("_")[1])}a=
{op:"device_add",name:$("#name").val(),rod:$("#name_rod").val(),mn:$("#name_mn").val(),equip:d.join()};a.name&&a.rod&&a.mn?(b.process(),$.post(AJAX_SA,a,function(a){a.success?($(".spisok").html(a.html),b.close(),_msg("Внесено!"),sortable()):b.abort()},"json")):(b.bottom.vkHint({msg:"<SPAN class=red>Необходимо заполнить все поля</SPAN>",top:-47,left:131,indent:50,show:1,remove:1}),a.name?a.rod?a.mn||$("#name_mn").focus():$("#name_rod").focus():$("#name").focus())}$(this);var b=_dialog({top:60,width:460,
head:"Добавление нового наименования устройства",content:'<table class="sa-device-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" /><tr><td class="label r">Родительный падеж (кого?):<td><input id="name_rod" type="text" maxlength="100" /><tr><td class="label r">Множественное число:<td><input id="name_mn" type="text" maxlength="100" /><tr><td class="label r top">Возможная комплектация:<td class="equip">'+devEquip+"</table>",submit:a});$("#name,#name_rod,#name_mn").keyEnter(a);
$("#name").focus()}).on("click",".sa-device .img_edit",function(){function a(){for(var a=$(".equip input"),e=[],f=0;f<a.length;f++){var g=a.eq(f);1==g.val()&&e.push(g.attr("id").split("_")[1])}a={op:"device_edit",id:b,name:$("#name").val(),rod:$("#name_rod").val(),mn:$("#name_mn").val(),equip:e.join()};a.name&&a.rod&&a.mn?(c.process(),$.post(AJAX_SA,a,function(a){a.success?($(".spisok").html(a.html),c.close(),_msg("Изменено!"),sortable()):c.abort()},"json")):(c.bottom.vkHint({msg:"<SPAN class=red>Необходимо заполнить все поля</SPAN>",
top:-47,left:131,indent:50,show:1,remove:1}),a.name?a.rod?a.mn||$("#name_mn").focus():$("#name_rod").focus():$("#name").focus())}for(var b=$(this),c=_dialog({top:60,width:460,head:"Изменение данных устройства",content:'<center><img src="/img/upload.gif"></center>',butSubmit:"Сохранить",submit:a});"DD"!=b[0].tagName;)b=b.parent();b=b.attr("val");$.post(AJAX_SA,{op:"device_get",id:b},function(b){c.content.html('<table class="sa-device-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" value="'+
b.name+'" /><tr><td class="label r">Родительный падеж (кого?):<td><input id="name_rod" type="text" maxlength="100" value="'+b.name_rod+'" /><tr><td class="label r">Множественное число:<td><input id="name_mn" type="text" maxlength="100" value="'+b.name_mn+'" /><tr><td class="label r top">Возможная комплектация:<td class="equip">'+b.equip+"</table>");$("#name,#name_rod,#name_mn").keyEnter(a);$("#name").focus()},"json")}).on("click",".sa-device .img_del",function(){var a=$(this),b=_dialog({top:90,width:300,
head:"Удаление устройства",content:"<center><b>Подтвердите удаление устройства.</b></center>",butSubmit:"Удалить",submit:function(){for(;"DD"!=a[0].tagName;)a=a.parent();var c={op:"device_del",id:a.attr("val")};b.process();$.post(AJAX_SA,c,function(a){a.success?($(".spisok").html(a.html),b.close(),_msg("Удалено!"),sortable()):b.abort()},"json")}})}).on("click",".sa-vendor .add",function(){function a(){var a={op:"vendor_add",device_id:DEVICE_ID,name:$("#name").val(),bold:$("#bold").val()};a.name?(b.process(),
$.post(AJAX_SA,a,function(a){a.success?($(".spisok").html(a.html),b.close(),_msg("Внесено!"),sortable()):b.abort()},"json")):(b.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:99,indent:50,show:1,remove:1}),$("#name").focus())}$(this);var b=_dialog({top:60,width:390,head:"Добавление нового наименования производителя",content:'<table class="sa-vendor-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" /><tr><td class="label r">Выделить:<td><input id="bold" type="hidden" /></table>',
submit:a});$("#name").focus().keyEnter(a);$("#bold")._check()}).on("click",".sa-vendor .img_edit",function(){function a(){var a={op:"vendor_edit",vendor_id:b.attr("val"),name:$("#name").val(),bold:$("#bold").val()};a.name?(d.process(),$.post(AJAX_SA,a,function(a){a.success?($(".spisok").html(a.html),d.close(),_msg("Изменено!"),sortable()):d.abort()},"json")):(d.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:99,indent:50,show:1,remove:1}),$("#name").focus())}for(var b=
$(this);"DD"!=b[0].tagName;)b=b.parent();var c=b.find(".name").hasClass("b")?1:0,c='<table class="sa-vendor-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" value="'+b.find(".name a").html()+'" /><tr><td class="label r">Выделить:<td><input id="bold" type="hidden" value="'+c+'" /></table>',d=_dialog({top:60,width:390,head:"Изменение данных производителя",content:c,butSubmit:"Сохранить",submit:a});$("#name").focus().keyEnter(a);$("#bold")._check()}).on("click",
".sa-vendor .img_del",function(){var a=$(this),b=_dialog({top:90,width:300,head:"Удаление производителя",content:"<center><b>Подтвердите удаление производителя.</b></center>",butSubmit:"Удалить",submit:function(){for(;"DD"!=a[0].tagName;)a=a.parent();var c={op:"vendor_del",vendor_id:a.attr("val")};b.process();$.post(AJAX_SA,c,function(a){a.success?($(".spisok").html(a.html),b.close(),_msg("Удалено!"),sortable()):b.abort()},"json")}})}).on("click",".sa-model .ajaxNext",function(){var a=$(this);if(!a.hasClass("busy")){var b=
{op:"model_next",vendor_id:VENDOR_ID,page:a.attr("val"),find:find.inp()};a.addClass("busy");$.post(AJAX_SA,b,function(b){b.success?(a.parent().parent().remove(),$("._spisok").append(b.html)):a.removeClass("busy")},"json")}}).on("click",".sa-model .add",function(){function a(){var a={op:"model_add",vendor_id:VENDOR_ID,name:$("#name").val()};a.name?(c.process(),$.post(AJAX_SA,a,function(a){a.success?($("._spisok").find(".tr").remove().end().append(a.html),c.close(),_msg("Внесено!")):(c.abort(),b(a.text))},
"json")):b("Не указано наименование")}function b(a){c.bottom.vkHint({msg:"<SPAN class=red>"+a+"</SPAN>",top:-47,left:99,indent:50,show:1,remove:1});$("#name").focus()}$(this);var c=_dialog({top:60,width:390,head:"Добавление нового наименования модели",content:'<table class="sa-model-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" /></table>',submit:a});$("#name").focus().keyEnter(a)}).on("click",".sa-model .img_edit",function(){function a(){var a={op:"model_edit",
model_id:b.attr("val"),name:$("#name").val()};a.name?(d.process(),$.post(AJAX_SA,a,function(c){c.success?(b.find(".name b").html(a.name),d.close(),_msg("Изменено!")):d.abort()},"json")):(d.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:99,indent:50,show:1,remove:1}),$("#name").focus())}for(var b=$(this);"TR"!=b[0].tagName;)b=b.parent();var c='<table class="sa-model-add"><tr><td class="label r">Наименование:<td><input id="name" type="text" maxlength="100" value="'+
b.find(".name b").html()+'" /></table>',d=_dialog({top:60,width:390,head:"Изменение данных модели",content:c,butSubmit:"Сохранить",submit:a});$("#name").focus().keyEnter(a)}).on("click",".sa-model ._spisok .img_del",function(){var a=$(this),b=_dialog({top:90,width:300,head:"Удаление модели",content:"<center><b>Подтвердите удаление модели.</b></center>",butSubmit:"Удалить",submit:function(){for(;"TR"!=a[0].tagName;)a=a.parent();var c={op:"model_del",model_id:a.attr("val")};b.process();$.post(AJAX_SA,
c,function(c){c.success?(a.remove(),b.close(),_msg("Удалено!")):b.abort()},"json")}})}).on("click",".sa-equip .rightLink a",function(){$(".sa-equip .rightLink a.sel").removeClass("sel");$(this).addClass("sel");var a={op:"equip_show",device_id:$(".sa-equip .rightLink .sel").attr("val")};$(".path").addClass("busy");$.post(AJAX_SA,a,function(a){$(".path").removeClass("busy");$("#eq-spisok").html(a.html);sortable()},"json")}).on("click",".sa-equip .add",function(){function a(){var a={op:"equip_add",name:$("#name").val(),
title:$("#title").val(),device_id:$(".sa-equip .rightLink .sel").attr("val")};a.name?(b.process(),$.post(AJAX_SA,a,function(a){a.success?($("#eq-spisok").html(a.html),b.close(),_msg("Внесено!"),sortable()):b.abort()},"json")):(b.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:77,indent:50,show:1,remove:1}),$("#name").focus())}$(this);var b=_dialog({top:90,width:350,head:"Добавление новой комплектации",content:'<table class="sa-equip-add"><tr><td class="label">Наименование:<td><input id="name" type="text" maxlength="100" /><tr><td class="label">Описание:<td><input id="title" type="text" maxlength="200" /></table>',
submit:a});$("#name,#title").keyEnter(a);$("#name").focus()}).on("click",".sa-equip .img_edit",function(){function a(){var a={op:"equip_edit",id:b,name:$("#name").val(),title:$("#title").val(),device_id:$(".sa-equip .rightLink .sel").attr("val")};a.name?(c.process(),$.post(AJAX_SA,a,function(a){a.success?($("#eq-spisok").html(a.html),c.close(),_msg("Сохранено!"),sortable()):c.abort()},"json")):(c.bottom.vkHint({msg:"<SPAN class=red>Не указано наименование</SPAN>",top:-47,left:77,indent:50,show:1,
remove:1}),$("#name").focus())}for(var b=$(this),c=_dialog({top:90,width:350,head:"Редактирование комплектации",content:'<center><img src="/img/upload.gif"></center>',butSubmit:"Сохранить",submit:a});"DD"!=b[0].tagName;)b=b.parent();b=b.attr("val");$.post(AJAX_SA,{op:"equip_get",id:b},function(b){c.content.html('<table class="sa-equip-add"><tr><td class="label">Наименование:<td><input id="name" type="text" maxlength="100" value="'+b.name+'" /><tr><td class="label">Описание:<td><input id="title" type="text" maxlength="200" value="'+
b.title+'" /></table>');$("#name,#title").keyEnter(a);$("#name").focus()},"json")}).on("click",".sa-equip .img_del",function(){var a=$(this),b=_dialog({top:90,width:300,head:"Удаление комплектации",content:"<center><b>Подтвердите удаление комплектации.</b></center>",butSubmit:"Удалить",submit:function(){for(;"DD"!=a[0].tagName;)a=a.parent();var c={op:"equip_del",id:a.attr("val"),device_id:$(".sa-equip .rightLink .sel").attr("val")};b.process();$.post(AJAX_SA,c,function(a){a.success?($("#eq-spisok").html(a.html),
b.close(),_msg("Удалено!"),sortable()):b.abort()},"json")}})}).on("click",".sa-equip .check0,.sa-equip .check1",function(){for(var a=$(".sa-equip ._sort input"),b=[],c=0;c<a.length;c++){var d=a.eq(c);1==d.val()&&b.push(d.attr("id").split("_")[1])}a={op:"equip_set",device_id:$(".sa-equip .rightLink .sel").attr("val"),ids:b.join()};$(".path").addClass("busy");$.post(AJAX_SA,a,function(a){$(".path").removeClass("busy")},"json")}).ready(function(){0<$(".sa-model").length&&(window.find=$("#find")._search({width:300,
txt:"Поиск по названию модели",enter:1,focus:1,func:function(a){var b=$(".path");b.hasClass("busy")||(a={op:"model_load",vendor_id:VENDOR_ID,find:a},b.addClass("busy"),$.post(AJAX_SA,a,function(a){b.removeClass("busy");a.success&&$("._spisok").find(".tr").remove().end().append(a.html)},"json"))}}))});
